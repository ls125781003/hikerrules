{"last_chapter_rule":"","pageList":[{"col_type":"movie_3","name":"推送","path":"push","rule":"js:\n//log(MY_URL);\nvar items = [];\nvar realurl = MY_URL.split('##')[1].split('???')[0];\nif (MY_PAGE == 1) {\n    items.push({\n        title: \"📽 推送到TVBox 📺\",\n        url: $(realurl).lazyRule(() => {\n            input = decodeURIComponent(input);\n            return 'hiker://page/push?rule=XYQ推送&pushurl=' + encodeURIComponent(input);\n        }),\n        col_type: \"text_center_1\",\n        desc: \"\",\n        pic_url: \"\"\n    });\n}\nif (decodeURIComponent(realurl).includes('www.aliyundrive') && !realurl.includes('%3B%7B')) {\n    eval(JSON.parse(fetch('hiker://page/sharid', {})).rule)\n}\nsetResult(items);"},{"col_type":"movie_3","name":"分享资源一级","path":"sharid","rule":"js:\n//var items = [];\nfunction formatDate(_date, _fmt) {\n    let fmt = _fmt || \"yyyy-MM-dd HH:mm:ss\";\n    const date = !isNaN(_date) ? new Date(_date * 1000) : new Date(_date);\n    const o = {\n        \"M+\": date.getMonth() + 1, //月份 \n        \"d+\": date.getDate(), //日 \n        \"h+\": date.getHours() % 12 == 0 ? 12 : date.getHours() % 12,\n        \"H+\": date.getHours(), //小时 \n        \"m+\": date.getMinutes(), //分 \n        \"s+\": date.getSeconds(), //秒 \n        \"q+\": Math.floor((date.getMonth() + 3) / 3), //季度 \n        \"S\": date.getMilliseconds() //毫秒 \n    };\n    if (/(y+)/.test(fmt)) {\n        fmt = fmt.replace(RegExp.$1, (date.getFullYear() + \"\").substr(4 - RegExp.$1.length));\n    }\n    for (let k in o) {\n        if (new RegExp(\"(\" + k + \")\").test(fmt)) {\n            fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : ((\"00\" + o[k]).substr((\"\" + o[k]).length)));\n        }\n    }\n    return fmt;\n};\n\nfunction formatSize(size) {\n    if (!size) {\n        return '';\n    }\n    const units = ['B', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];\n    let i = 0;\n    while (size >= 1024) {\n        size /= 1024;\n        i++;\n    }\n    size = i ? Number(size.toFixed(2)) : size;\n    return `${size} ${units[i]}`;\n}\n//log(realurl);\n\nif (MY_PAGE == 1) {\n    clearMyVar('nextpage');\n}\nif (MY_PAGE > 1 && getMyVar('nextpage', '') == '') {\n    log('没有下一页');\n} else {\n    try {\n        //var reftoken = JSON.parse(fetch('hiker://files/rules/xyq/alitoken.json', {})).refresh_token;\n        var reftoken = JSON.parse(fetch('hiker://files/rules/icy/icy-ali-token.json', {}))[0].refresh_token;\n        var shareId = decodeURIComponent(realurl).split('com/s/')[1].substring(0, 11);\n        let getshar = fetch('https://api.aliyundrive.com/adrive/v3/share_link/get_share_by_anonymous', {\n            headers: {\n                'Content-Type': 'application/json'\n            },\n            body: '{\"share_id\":\"' + shareId + '\"}',\n            method: 'POST'\n        });\n        if (getshar.includes(\"share_link is forbidden\")) {\n            items.push({\n                title: '文件违规，根据相关法律法规要求，该文件已禁止访问。',\n                url: decodeURIComponent(getResCode().split('##')[1]),\n                col_type: 'text_center_1'\n            });\n        }\n        if (getshar.includes(\"share_link is cancelled\") || getshar.includes(\"share_link is expired\")) {\n            items.push({\n                title: '来晚啦，该分享已失效。',\n                url: decodeURIComponent(getResCode().split('##')[1]),\n                col_type: 'text_center_1'\n            });\n        }\n        if (getshar.includes(\"share_link cannot be found\")) {\n            items.push({\n                title: '你打开的链接有误，请重试。',\n                url: decodeURIComponent(getResCode().split('##')[1]),\n                col_type: 'text_center_1'\n            });\n        }\n\n        let pushname = JSON.parse(getshar).file_infos[0].file_name;\n        //var listyp = JSON.parse(getshar).file_infos[0].type;\n        //var pfileid = JSON.parse(getshar).file_infos[0].file_id;\n\n        var sharetoken = JSON.parse(fetch('https://api.aliyundrive.com/v2/share_link/get_share_token', {\n            headers: {\n                'Content-Type': 'application/json'\n            },\n            body: '{\"share_pwd\":\"\",\"share_id\":\"' + shareId + '\"}',\n            method: 'POST'\n        })).share_token;\n        //log(sharetoken);\n\n        let next = getMyVar('nextpage', '') != '' ? ',\"marker\":\"' + getMyVar('nextpage') + '\"' : '';\n        if (!decodeURIComponent(realurl).includes('/folder/')) {\n            //if(!listyp == 'folder'){\n            var rescod = fetch('https://api.aliyundrive.com/adrive/v3/file/list', {\n                headers: {\n                    'Content-Type': 'application/json',\n                    'X-Share-Token': sharetoken\n                },\n                body: '{\"share_id\":\"' + shareId + '\",\"parent_file_id\":\"root\",\"limit\":100,\"image_thumbnail_process\":\"image/resize,w_160/format,jpeg\",\"image_url_process\":\"image/resize,w_1920/format,jpeg\",\"video_thumbnail_process\":\"video/snapshot,t_1000,f_jpg,ar_auto,w_300\",\"order_by\":\"name\",\"order_direction\":\"ASC\"' + next + '}',\n                method: 'POST'\n            });\n            //log(rescod);\n            if (rescod.includes(\"ParamFlowException\")) {\n                refreshPage();\n            }\n            var listyp = JSON.parse(rescod).items[0].type;\n            var pfileid = JSON.parse(rescod).items[0].file_id;\n        } else {\n            var listyp = 'folder';\n            var pfileid = decodeURIComponent(realurl).split('folder/')[1]\n\n        }\n        //log(html);\n        if (listyp == 'folder') {\n            var rescod = fetch('https://api.aliyundrive.com/adrive/v3/file/list', {\n                headers: {\n                    'Content-Type': 'application/json',\n                    'X-Share-Token': sharetoken\n                },\n                body: '{\"share_id\":\"' + shareId + '\",\"parent_file_id\":\"' + pfileid + '\",\"limit\":100,\"image_thumbnail_process\":\"image/resize,w_160/format,jpeg\",\"image_url_process\":\"image\\/resize,w_1920/format,jpeg\",\"video_thumbnail_process\":\"video/snapshot,t_1000,f_jpg,ar_auto,w_300\",\"order_by\":\"name\",\"order_direction\":\"ASC\"' + next + '}',\n                method: 'POST'\n            });\n            if (rescod.includes(\"ParamFlowException\")) {\n                refreshPage();\n            }\n        } //取文件夹\n        //log(rescod);\n        if (JSON.parse(rescod).next_marker) {\n            let marker = JSON.parse(rescod).next_marker;\n            if (marker.length > 10) {\n                putMyVar('nextpage', marker);\n            } else {\n                clearMyVar('nextpage');\n            }\n        }\n        var conts = JSON.parse(rescod).items;\n        var dongtai = JSON.parse(fetch('hiker://page/lazyurl', {})).rule.toString();\n        var tuisong = [];\n        var zimu = [];\n        for (let i in conts) {\n            //var listyp = conts[i].type;\n            if (conts[i].type != 'folder') {\n                let fname = conts[i].name;\n                let ftype = fname.toLowerCase();\n                let cate = conts[i].category;\n                if (ftype.endsWith('.srt') || ftype.endsWith('.vtt') || ftype.endsWith('.ass')) {\n                    zimu.push({\n                        tit: fname.substring(0, fname.lastIndexOf(\".\")),\n                        ext: conts[i].file_extension,\n                        fid: conts[i].file_id\n                    });\n                };\n                if (cate == 'video' || cate == 'audio') {\n                    tuisong.push(\n                        fname.replace(/\\#/g, '_').replace(/\\$/g, '_') + '$' + cate + '|' + conts[i].file_id\n                    );\n                };\n            }\n        }\n        for (var i in conts) {\n            var listyp = conts[i].type;\n            if (listyp != 'folder') {\n                var cate = conts[i].category;\n                var fname = conts[i].name;\n                if (cate == 'video') {\n                    var title = '📺' + conts[i].name;\n                } else if (cate == 'doc') {\n                    var title = '📖' + conts[i].name;\n                } else if (cate == 'image') {\n                    var title = '🖼' + conts[i].name;\n                } else if (cate == 'zip') {\n                    var title = '📦' + conts[i].name;\n                } else {\n                    var title = conts[i].name\n                }\n                items.push({\n                    title: title,\n                    url: $(conts[i].file_id).lazyRule((shareId, dongtai, cate, fname, reftoken, zimu) => {\n                        if (getItem('singlepush', '') == '1') {\n                            return 'hiker://page/push?rule=XYQ推送&pushurl=' + encodeURIComponent(JSON.stringify({\n                                \"name\": fname,\n                                \"refresh_token\": reftoken,\n                                \"url\": fname.replace(/\\#/g, '_').replace(/\\$/g, '_') + '$' + cate + '|' + input,\n                                \"share_id\": shareId\n                            }));\n                        } else {\n                            eval(dongtai);\n                            return play\n                        }\n                    }, shareId, dongtai, cate, fname, reftoken, zimu),\n                    desc: formatDate(conts[i].updated_at) + '  ' + formatSize(conts[i].size),\n                    extra: {\n                        longClick: [{\n                            title: '推送到TVBox',\n                            js: $.toString((shareId, fileid, cate, fname, reftoken) => {\n                                return 'hiker://page/push?rule=XYQ推送&pushurl=' + encodeURIComponent(JSON.stringify({\n                                    \"name\": fname,\n                                    \"refresh_token\": reftoken,\n                                    \"url\": fname.replace(/\\#/g, '_').replace(/\\$/g, '_') + '$' + cate + '|' + fileid,\n                                    \"share_id\": shareId\n                                }));\n                            }, shareId, conts[i].file_id, cate, fname, reftoken)\n                        }],\n                        id: conts[i].file_id\n                    },\n                    col_type: 'text_1'\n\n                });\n            } else {\n                items.push({\n                    title: '📂' + conts[i].name,\n                    url: $('hiker://empty' + conts[i].file_id + '???fypage').rule((shareId, sharetoken, pushname) => {\n                        eval(JSON.parse(fetch('hiker://page/ruleloop', {})).rule);\n                    }, shareId, sharetoken, conts[i].name),\n                    col_type: 'flex_button'\n                });\n\n            } //end if\n        } //end for i\n        //log(tuisong);\n        //let pushname = JSON.parse(rescod).items[0].name;\n        eval(JSON.parse(fetch('hiker://page/pushcode', {})).rule);\n\n    } catch (e) {\n        /*\n        items.push({\n            title: '欧欧，报错了。',\n            url: decodeURIComponent(getResCode().split('##')[1]),\n            col_type: 'text_center_1'\n        });\n        */\n    }\n}\n/*\nsetHomeResult({\n    data: items\n});\n*/"},{"col_type":"movie_3","name":"分享资源嵌套","path":"ruleloop","rule":"var items = [];\n\nfunction formatDate(_date, _fmt) {\n    let fmt = _fmt || \"yyyy-MM-dd HH:mm:ss\";\n    const date = !isNaN(_date) ? new Date(_date * 1000) : new Date(_date);\n    const o = {\n        \"M+\": date.getMonth() + 1, //月份 \n        \"d+\": date.getDate(), //日 \n        \"h+\": date.getHours() % 12 == 0 ? 12 : date.getHours() % 12,\n        \"H+\": date.getHours(), //小时 \n        \"m+\": date.getMinutes(), //分 \n        \"s+\": date.getSeconds(), //秒 \n        \"q+\": Math.floor((date.getMonth() + 3) / 3), //季度 \n        \"S\": date.getMilliseconds() //毫秒 \n    };\n    if (/(y+)/.test(fmt)) {\n        fmt = fmt.replace(RegExp.$1, (date.getFullYear() + \"\").substr(4 - RegExp.$1.length));\n    }\n    for (let k in o) {\n        if (new RegExp(\"(\" + k + \")\").test(fmt)) {\n            fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : ((\"00\" + o[k]).substr((\"\" + o[k]).length)));\n        }\n    }\n    return fmt;\n};\n\nfunction formatSize(size) {\n    if (!size) {\n        return '';\n    }\n    const units = ['B', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];\n    let i = 0;\n    while (size >= 1024) {\n        size /= 1024;\n        i++;\n    }\n    size = i ? Number(size.toFixed(2)) : size;\n    return `${size} ${units[i]}`;\n}\n//let tvip = getItem('hikertvboxset', '');\n\n//log(getResCode());\nif (MY_PAGE == 1) {\n    clearMyVar('nextpage');\n    items.unshift({\n        title: \"📽推送当前文件夹📺\",\n        url: $('https://www.aliyundrive.com/s/' + shareId + '/folder/' + getResCode().split('???')[0]).lazyRule(() => {\n            return 'hiker://page/push?rule=XYQ推送&pushurl=' + encodeURIComponent(input);\n        }),\n        col_type: \"scroll_button\"\n    });\n}\nif (MY_PAGE > 1 && getMyVar('nextpage', '') == '') {\n    log('没有下一页');\n} else {\n    let reftoken = JSON.parse(fetch('hiker://files/rules/icy/icy-ali-token.json', {}))[0].refresh_token;\n\n    let next = getMyVar('nextpage', '') != '' ? ',\"marker\":\"' + getMyVar('nextpage') + '\"' : '';\n\n    var rescod = fetch('https://api.aliyundrive.com/adrive/v3/file/list', {\n        headers: {\n            'Content-Type': 'application/json',\n            'X-Share-Token': sharetoken\n        },\n        body: '{\"share_id\":\"' + shareId + '\",\"parent_file_id\":\"' + getResCode().split('???')[0] + '\",\"limit\":100,\"image_thumbnail_process\":\"image/resize,w_160/format,jpeg\",\"image_url_process\":\"image\\/resize,w_1920/format,jpeg\",\"video_thumbnail_process\":\"video/snapshot,t_1000,f_jpg,ar_auto,w_300\",\"order_by\":\"name\",\"order_direction\":\"ASC\"' + next + '}',\n        method: 'POST'\n    });\n    //log(rescod);\n    if (JSON.parse(rescod).next_marker) {\n        let marker = JSON.parse(rescod).next_marker;\n        if (marker.length > 10) {\n            putMyVar('nextpage', marker);\n        } else {\n            clearMyVar('nextpage');\n        }\n    }\n    var conts = JSON.parse(rescod).items;\n    var dongtai = JSON.parse(fetch('hiker://page/lazyurl', {})).rule.toString();\n    var tuisong = [];\n    var zimu = [];\n    for (let i in conts) {\n        //var listyp = conts[i].type;\n        if (conts[i].type != 'folder') {\n            let fname = conts[i].name;\n            let ftype = fname.toLowerCase();\n            let cate = conts[i].category;\n            if (ftype.endsWith('.srt') || ftype.endsWith('.vtt') || ftype.endsWith('.ass')) {\n                zimu.push({\n                    tit: fname.substring(0, fname.lastIndexOf(\".\")),\n                    ext: conts[i].file_extension,\n                    fid: conts[i].file_id\n                });\n            };\n            if (cate == 'video' || cate == 'audio') {\n                tuisong.push(\n                    fname.replace(/\\#/g, '_').replace(/\\$/g, '_') + '$' + cate + '|' + conts[i].file_id\n                );\n            };\n        }\n    }\n    for (var i in conts) {\n\n        var listyp = conts[i].type;\n        if (listyp != 'folder') {\n            var cate = conts[i].category;\n            var fname = conts[i].name;\n            if (cate == 'video') {\n                var title = '📺' + conts[i].name;\n            } else if (cate == 'doc') {\n                var title = '📖' + conts[i].name;\n            } else if (cate == 'image') {\n                var title = '🖼' + conts[i].name;\n            } else if (cate == 'zip') {\n                var title = '📦' + conts[i].name;\n            } else {\n                var title = conts[i].name\n            }\n            items.push({\n                title: title,\n                url: $(conts[i].file_id).lazyRule((shareId, dongtai, cate, fname, reftoken, zimu) => {\n                    if (getItem('singlepush', '') == '1') {\n                        return 'hiker://page/push?rule=XYQ推送&pushurl=' + encodeURIComponent(JSON.stringify({\n                            \"name\": fname,\n                            \"refresh_token\": reftoken,\n                            \"url\": fname.replace(/\\#/g, '_').replace(/\\$/g, '_') + '$' + cate + '|' + input,\n                            \"share_id\": shareId\n                        }));\n                    } else {\n                        eval(dongtai);\n                        return play\n                    }\n                }, shareId, dongtai, cate, fname, reftoken, zimu),\n                desc: formatDate(conts[i].updated_at) + '  ' + formatSize(conts[i].size),\n                extra: {\n                    longClick: [{\n                        title: '推送到TVBox',\n                        js: $.toString((shareId, fileid, cate, fname, reftoken) => {\n                            return 'hiker://page/push?rule=XYQ推送&pushurl=' + encodeURIComponent(JSON.stringify({\n                                \"name\": fname,\n                                \"refresh_token\": reftoken,\n                                \"url\": fname.replace(/\\#/g, '_').replace(/\\$/g, '_') + '$' + cate + '|' + fileid,\n                                \"share_id\": shareId\n                            }));\n                        }, shareId, conts[i].file_id, cate, fname, reftoken)\n                    }],\n                    id: conts[i].file_id\n                },\n                col_type: 'text_1'\n\n            });\n            if (cate == 'video' || cate == 'audio') {\n                tuisong.push(\n                    title.replace(/\\#/g, '_').replace(/\\$/g, '_') + '$' + cate + '|' + conts[i].file_id\n                );\n            }\n        } else {\n            items.push({\n                title: '📂' + conts[i].name,\n                url: $('hiker://empty' + conts[i].file_id + '???fypage').rule((shareId, sharetoken, pushname) => {\n                    eval(JSON.parse(fetch('hiker://page/ruleloop', {})).rule);\n                }, shareId, sharetoken, conts[i].name),\n                col_type: 'flex_button'\n            });\n\n        } //end if\n\n\n    }\n    eval(JSON.parse(fetch('hiker://page/pushcode', {})).rule);\n}\nsetHomeResult({\n    data: items\n});"},{"col_type":"movie_3","name":"分享资源动态解析","path":"lazyurl","rule":"var defdriveid = getMyVar('defdriveid', ''),\n    reaccessTk = getMyVar(\"aliaccessTk\", ''),\n    timeToken = getMyVar('timeToken', '0'),\n    stToken = getMyVar('stToken', '0'),\n    shareiid = getMyVar('shareiid', shareId),\n    sharetoken = getItem('sharetoken', ''),\n    resdriveid = getMyVar('resdriveid', ''),\n    ftype = fname.toLowerCase();\n//log((parseInt(timeToken) - parseInt(new Date().getTime() / 1000)).toString());\nfunction accessTk() {\n    if (reaccessTk == '' || (parseInt(timeToken) - parseInt(new Date().getTime() / 1000)).toString() <= 600) {\n        log('刷新reaccessTk');\n        let ntoken = JSON.parse(fetch('hiker://files/rules/icy/icy-ali-token.json', {}));\n        var reftoken = ntoken[0].refresh_token;\n        let refresh = fetch('https://auth.aliyundrive.com/v2/account/token', {\n            headers: {\n                'User-Agent': PC_UA,\n                'Content-Type': 'application/json',\n                'Referer': 'https://www.aliyundrive.com/'\n            },\n            body: '{\"refresh_token\":\"' + reftoken + '\",\"grant_type\":\"refresh_token\"}',\n            method: 'POST'\n        });\n        ntoken[0] = JSON.parse(refresh);\n        if (!fileExist(\"hiker://files/rules/icy/icy-ali-token.json\") || refresh.length > 300) {\n            writeFile(\"hiker://files/rules/icy/icy-ali-token.json\", JSON.stringify(ntoken));\n        }\n        putMyVar('timeToken', (parseInt(JSON.parse(refresh).expires_in) + parseInt(new Date().getTime() / 1000)).toString());\n        defdriveid = JSON.parse(refresh).default_drive_id;\n        putMyVar('defdriveid', defdriveid);\n        reaccessTk = JSON.parse(refresh).token_type + ' ' + JSON.parse(refresh).access_token;\n        putMyVar(\"aliaccessTk\", reaccessTk);\n        \n    }\n};\nfunction resourceID() {\n    let userresinfo = JSON.parse(fetch(\"https://user.aliyundrive.com/v2/user/get\", {\n        headers: {\n            'content-type': 'application/json',\n            'User-Agent': PC_UA,\n            \"authorization\": reaccessTk,\n            'Referer': 'https://www.aliyundrive.com/'\n        },\n        body: {},\n        method: 'POST'\n    }));\n    if (userresinfo.resource_drive_id) {\n        resdriveid = userresinfo.resource_drive_id;\n        putMyVar('resdriveid', resdriveid);\n    }\n}\naccessTk();\nresourceID();\n//刷新sharetoken\nif (shareiid != shareId || (parseInt(stToken) - parseInt(new Date().getTime() / 1000)).toString() <= 600) {\n    var sharetk = fetch('https://api.aliyundrive.com/v2/share_link/get_share_token', {\n        headers: {\n            'User-Agent': PC_UA,\n            'Content-Type': 'application/json'\n        },\n        body: '{\"share_pwd\":\"\",\"share_id\":\"' + shareId + '\"}',\n        method: 'POST'\n    });\n    log('刷新sharetoken');\n    sharetoken = JSON.parse(sharetk).share_token;\n    setItem('sharetoken', JSON.parse(sharetk).share_token);\n    putMyVar('stToken', (parseInt(JSON.parse(sharetk).expires_in) + parseInt(new Date().getTime() / 1000)).toString());\n    putMyVar('shareiid', shareId);\n}\n\nconst transcoding = {\n    UHD: \"4K 超清\",\n    QHD: \"2K 超清\",\n    FHD: \"1080 全高清\",\n    HD: \"720 高清\",\n    SD: \"540 标清\",\n    LD: \"360 流畅\"\n};\nif (!fileExist(\"hiker://files/rules/icy/icy-ali-OpenToken.json\")) {\n    var OpenToken = {\n        'RefreshTokenOpen': '',\n        'AccessTokenOpen': ''\n    };\n} else {\n    var OpenToken = JSON.parse(fetch('hiker://files/rules/icy/icy-ali-OpenToken.json', {}));\n}\n//var reftoken = JSON.parse(fetch('hiker://files/rules/icy/icy-ali-token.json', {}))[0].refresh_token;\nfunction getsub(zmfid, zmext) {\n    try {\n        var json = fetch('https://api.aliyundrive.com/v2/file/get_share_link_download_url', {\n            headers: {\n                'Content-Type': 'application/json',\n                'Authorization': reaccessTk,\n                'X-Share-Token': sharetoken\n            },\n            body: '{\"share_id\":\"' + shareId + '\",\"file_id\":\"' + zmfid + '\"}',\n            method: 'POST'\n        });\n        //log(json);\n        let zimul = JSON.parse(json).download_url;\n        downloadFile(zimul, 'hiker://files/download/subtitling.' + zmext, {\n            'Referer': 'https://www.aliyundrive.com/'\n        });\n        return getPath('hiker://files/download/subtitling.' + zmext)\n    } catch (e) {\n        return \"\";\n    }\n}\n\nfunction aliSharePlayUrl(share_id, file_id, alitoken) {\n    try {\n        function getNowTime() {\n            const yy = new Date().getFullYear()\n            const MM = (new Date().getMonth() + 1) < 10 ? '0' + (new Date().getMonth() + 1) : (new Date().getMonth() + 1)\n            const dd = new Date().getDate() < 10 ? '0' + new Date().getDate() : new Date().getDate()\n            const HH = new Date().getHours() < 10 ? '0' + new Date().getHours() : new Date().getHours()\n            const mm = new Date().getMinutes() < 10 ? '0' + new Date().getMinutes() : new Date().getMinutes()\n            return yy + '' + dd + '' + HH + '' + MM + '' + mm\n        }\n\n        let sharetoken = JSON.parse(request('https://api.aliyundrive.com/v2/share_link/get_share_token', {\n            body: {\n                \"share_pwd\": \"\",\n                \"share_id\": share_id\n            },\n            method: 'POST',\n            timeout: 3000\n        })).share_token;\n\n        let headers = {\n            'content-type': 'application/json;charset=UTF-8',\n            \"origin\": \"https://www.aliyundrive.com\",\n            \"referer\": \"https://www.aliyundrive.com/\",\n            //\"user-agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/110.0.0.0 Safari/537.36\",\n            \"user-agent\": PC_UA,\n            \"x-canary\": \"client=web,app=adrive,version=v3.1.0\"\n        };\n        let nowtime = Date.now();\n        let oldtime = parseInt(getMyVar('userinfoChecktime', '0').replace('time', ''));\n        let userinfo;\n        let aliuserinfo = storage0.getMyVar('aliuserinfo');\n        if (aliuserinfo && aliuserinfo.user_id && nowtime < (oldtime + 1 * 60 * 60 * 1000)) {\n            userinfo = aliuserinfo;\n        } else {\n            userinfo = JSON.parse(request('https://auth.aliyundrive.com/v2/account/token', {\n                headers: headers,\n                body: {\n                    \"refresh_token\": alitoken,\n                    \"grant_type\": \"refresh_token\"\n                },\n                method: 'POST',\n                timeout: 3000\n            }));\n            storage0.putMyVar('aliuserinfo', userinfo);\n            putMyVar('userinfoChecktime', nowtime + 'time');\n        }\n        let authorization = 'Bearer ' + userinfo.access_token;\n        let deviceId = userinfo.device_id;\n        let userId = userinfo.user_id;\n        let signature;\n\n        let as = justTestSign(\"5dde4e1bdf9e4966b387ba58f4b3fdc3\", deviceId, userId);\n        //log(a);\n        let bp = as.split(\"##\");\n        var sign = bp[0];\n        var pubKey = bp[bp.length - 1];\n\n        let i = 0;\n        do {\n\n            let sess = fetch('https://api.aliyundrive.com/users/v1/users/device/create_session', {\n                headers: {\n                    'Content-Type': 'application/json',\n                    'User-Agent': PC_UA,\n                    'Referer': 'https://www.aliyundrive.com/',\n                    'Authorization': authorization,\n                    'X-Share-Token': sharetoken,\n                    'x-device-id': deviceId,\n                    'x-signature': sign\n                },\n                body: '{\"deviceName\":\"Chrome浏览器\",\"modelName\":\"Windows网页版\",\"nonce\":0,\"pubKey\":\"' + pubKey + '\",\"refreshToken\":\"' + alitoken + '\"}',\n                method: 'POST'\n            });\n            if (sess.includes('success')) {\n                break;\n            }\n            log('create_session ' + sess);\n            as = justTestSign(\"5dde4e1bdf9e4966b387ba58f4b3fdc3\", deviceId, userId);\n            //log(a);\n            bp = as.split(\"##\");\n            sign = bp[0];\n            pubKey = bp[bp.length - 1];\n            i++;\n        } while (i < 5);\n\n        signature = sign;\n        headers['authorization'] = authorization;\n        headers['x-device-id'] = deviceId;\n        headers['x-signature'] = signature;\n        let aliyunUrl = [];\n        headers['x-share-token'] = sharetoken;\n        headers['fileid'] = userId;\n        let data = {\n            \"category\": \"live_transcoding\",\n            \"file_id\": file_id,\n            \"get_preview_url\": true,\n            \"share_id\": share_id,\n            \"template_id\": \"\",\n            \"get_subtitle_info\": true\n        }\n        //log(data);\n        let json = JSON.parse(request('https://api.aliyundrive.com/v2/file/get_share_link_video_preview_play_info', {\n            headers: headers,\n            body: data,\n            method: 'POST',\n            timeout: 3000\n        }));\n        aliyunUrl = json.video_preview_play_info.live_transcoding_task_list;\n        aliyunUrl.reverse();\n\n        return aliyunUrl;\n    } catch (e) {\n        log('根据共享链接获取播放地址失败>' + e.message);\n        return \"\";\n    }\n}\n\nfunction getAliUrl(share_id, file_id, alitoken) {\n    try {\n        let urls = [];\n        let names = [];\n        let heads = [];\n        let u = startProxyServer($.toString((aliSharePlayUrl, file_id, share_id, alitoken) => {\n            function geturl(fileid, line) {\n                //预加载时会变file_id,所以ts过期更新时还取原来的id\n                let playUrlList = aliSharePlayUrl(share_id, fileid, alitoken) || [];\n                let aliurl;\n                playUrlList.forEach((item) => {\n                    if (item.template_id == line) {\n                        aliurl = item.url;\n                        /*aliurl = JSON.parse(request(item.url, {\n                            headers: {\n                                'User-Agent': PC_UA,\n                                'Referer': 'https://www.aliyundrive.com/'\n                            },\n                            onlyHeaders: true,\n                            redirect: false,\n                            timeout: 3000\n                        })).headers.location[0];*/\n                    }\n                })\n                //上面是获取阿里的播放地址\n                //log(\"我在代理\" + aliurl);\n                let home = aliurl.split('media.m3u8')[0];\n                let f = fetch(aliurl, {\n                    headers: {\n                        'User-Agent': PC_UA,\n                        'Referer': 'https://www.aliyundrive.com/'\n                    },\n                    timeout: 3000\n                }).split(\"\\n\");\n                let ff = f.map(it => {\n                    if (it.startsWith(\"media-\")) {\n                        return \"/proxy?url=\" + base64Encode(home + it);\n                    }\n                    return it;\n                }).join(\"\\n\");\n                //log('ufid-'+fileid);\n                writeFile('hiker://files/cache/_fileSelect_' + fileid + '.m3u8', ff);\n                return ff;\n            }\n            let url = base64Decode(MY_PARAMS.url);\n            if (url.includes(\".ts\")) {\n                let fid = url.split('&f=')[1].split('&')[0];\n                //log('sfid-'+fid);\n                let f = fetch('hiker://files/cache/_fileSelect_' + fid + '.m3u8').split(\"\\n\");\n                f.forEach(it => {\n                    if (it && it.startsWith('/proxy?url=')) {\n                        let furl = base64Decode(it.replace('/proxy?url=', ''));\n                        if (url.substr(url.indexOf('/media-'), url.indexOf('.ts')) == furl.substr(furl.indexOf('/media-'), furl.indexOf('.ts'))) {\n                            url = furl;\n                        }\n                    }\n                })\n                let expires = url.split('x-oss-expires=')[1].split('&')[0];\n                const lasttime = parseInt(expires) - Date.now() / 1000;\n                if (lasttime < 60) {\n                    //log('过期更新')\n                    let line = url.split('/media')[0]; //取之前播放的ts段线路\n                    line = line.substring(line.lastIndexOf('/') + 1);\n                    let f = geturl(fid, line).split(\"\\n\");\n                    f.forEach(it => {\n                        if (it && it.startsWith('/proxy?url=')) {\n                            let furl = base64Decode(it.replace('/proxy?url=', ''));\n                            if (url.substr(url.indexOf('/media-'), url.indexOf('.ts')) == furl.substr(furl.indexOf('/media-'), furl.indexOf('.ts'))) {\n                                url = furl;\n                            }\n                        }\n                    })\n\n                } else {\n                    //log('未过期')\n                    //log(\"代理ts：\" + url);\n                }\n                return JSON.stringify({\n                    statusCode: 302,\n                    headers: {\n                        \"Location\": url,\n                        \"User-Agent\": PC_UA,\n                        'Referer': 'https://www.aliyundrive.com/'\n                    }\n                });\n            } else {\n                //log('首次更新')\n                let line = url.split('|')[1];\n                let ff = geturl(file_id, line);\n                return ff;\n            }\n        }, aliSharePlayUrl, file_id, share_id, alitoken));\n\n        let playUrlList = aliSharePlayUrl(share_id, file_id, alitoken) || [];\n\n        if (playUrlList.length > 0) {\n            playUrlList.forEach((item) => {\n                urls.push(u + \"?url=\" + base64Encode(item.url + \"|\" + item.template_id) + \"#.m3u8\");\n                names.push(transcoding[item.template_id] ? transcoding[item.template_id] : item.template_height);\n                heads.push({\n                    'User-Agent': PC_UA,\n                    'Referer': 'https://www.aliyundrive.com/'\n                });\n            })\n            /*\n            return {\n                urls: urls,\n                names: names,\n                headers: heads\n            };*/\n            var mult = {\n                urls: urls,\n                names: names,\n                headers: heads\n            };\n            if (zimu.length > 0) {\n                for (let i in zimu) {\n                    var zimut = zimu[i].tit;\n                    if (fname.includes(zimut) || zimut.includes(fname.substring(0, fname.lastIndexOf('.')))) {\n                        mult['subtitle'] = getsub(zimu[i].fid, zimu[i].ext);\n                        break;\n                    }\n                }\n            }\n\n            return mult;\n        } else {\n            log('未获取阿里播放地址，建议重进软件再试一次')\n            return {};\n        }\n    } catch (e) {\n        log('获取共享链接播放地址失败>' + e.message);\n        return {};\n    }\n}\n\nif (cate == 'video') {\n    if (getItem('quality', '') == '1') {\n        //原画\n        //accessTk();\n        function oauthRedirect(code) {\n            try {\n                if (getMyVar('ored', '1') != '0') {\n                    let json = fetch('https://api.xhofe.top/alist/ali_open/code', {\n                        headers: {\n                            'User-Agent': PC_UA,\n                            'Referer': 'https://www.aliyundrive.com/'\n\n                        },\n                        body: {\n                            \"code\": code,\n                            \"grant_type\": \"authorization_code\"\n                        },\n                        method: 'POST'\n                    });\n                    if (json == \"\"||!JSON.parse(json)) {\n                        json = fetch('https://api-cf.nn.ci/alist/ali_open/code', {\n                            headers: {\n                                'User-Agent': PC_UA,\n                                'Referer': 'https://www.aliyundrive.com/'\n\n                            },\n                            body: {\n                                \"code\": code,\n                                \"grant_type\": \"authorization_code\"\n                            },\n                            method: 'POST'\n                        });\n                    }\n                    log('获取RefreshTokenOpen');\n                    if (json.includes('Too Many Requests')) {\n                        putMyVar('ored', '0');\n                        toast('请求太频繁，被封IP了');\n                        log('请求太频繁，被封IP了');\n                        return '';\n                    } else {\n                        putMyVar('ored', '1');\n                        if (JSON.parse(json).refresh_token) {\n                            let getRefreshTokenOpen = JSON.parse(json).refresh_token;\n                            OpenToken.RefreshTokenOpen = getRefreshTokenOpen;\n                            let getAccessTokenOpen = JSON.parse(json).token_type + ' ' + JSON.parse(json).access_token;\n                            OpenToken.AccessTokenOpen = getAccessTokenOpen;\n                            writeFile(\"hiker://files/rules/icy/icy-ali-OpenToken.json\", JSON.stringify(OpenToken));\n\n                            putMyVar('redirect', '1');\n                        }\n                    }\n                }\n            } catch (e) {}\n        };\n\n        function oauthRequest() {\n            try {\n                let json = fetch('https://open.aliyundrive.com/oauth/users/authorize?client_id=' + '76917ccccd4441c39457a04f6084fb2f' + '&redirect_uri=https://alist.nn.ci/tool/aliyundrive/callback&scope=user:base,file:all:read,file:all:write&state=', {\n                    headers: {\n                        'User-Agent': PC_UA,\n                        'Referer': 'https://www.aliyundrive.com/',\n                        'authorization': reaccessTk, //getAccessToken\n                        'x-canary': 'client=web,app=share,version=v2.3.1',\n                        'x-share-token': sharetoken\n\n                    },\n                    body: {\n                        \"authorize\": 1,\n                        \"scope\": \"user:base,file:all:read,file:all:write\"\n                    },\n                    method: 'POST'\n                });\n                //log('oauthreq\\n' + json);\n                let code = JSON.parse(json).redirectUri.split(\"code=\")[1];\n                //log(code);\n                oauthRedirect(code);\n            } catch (e) {\n                reaccessTk = '';\n                accessTk();\n            }\n        };\n\n        function refreshOpenToken() {\n            try {\n                if (getMyVar('rot', '1') != '0') {\n                    let json = fetch('https://api.xhofe.top/alist/ali_open/token', {\n                        headers: {\n                            'User-Agent': PC_UA,\n                            'Referer': 'https://www.aliyundrive.com/'\n                        },\n                        body: {\n                            'grant_type': 'refresh_token',\n                            'refresh_token': OpenToken.RefreshTokenOpen\n                        },\n                        method: 'POST'\n                    });\n                    if (json == \"\") {\n                        json = fetch('https://api-cf.nn.ci/alist/ali_open/code', {\n                            headers: {\n                                'User-Agent': PC_UA,\n                                'Referer': 'https://www.aliyundrive.com/'\n                            },\n                            body: {\n                                'grant_type': 'refresh_token',\n                                'refresh_token': OpenToken.RefreshTokenOpen\n                            },\n                            method: 'POST'\n                        });\n                    }\n                    log('获取AccessTokenOpen');\n                    if (json.includes('Too Many Requests')) {\n                        putMyVar('rot', '0');\n                        toast('请求太频繁，被封IP了');\n                        //log('请求太频繁，被封IP了');\n                        return '';\n                    } else {\n                        putMyVar('rot', '1');\n                        if (JSON.parse(json).refresh_token) {\n                            let getRefreshTokenOpen = JSON.parse(json).refresh_token;\n                            OpenToken.RefreshTokenOpen = getRefreshTokenOpen;\n                            let getAccessTokenOpen = JSON.parse(json).token_type + ' ' + JSON.parse(json).access_token;\n                            OpenToken.AccessTokenOpen = getAccessTokenOpen;\n                            writeFile(\"hiker://files/rules/icy/icy-ali-OpenToken.json\", JSON.stringify(OpenToken));\n                        }\n                    }\n\n                }\n            } catch (e) {}\n        };\n\n        function copy(fileId) {\n            try {\n                let json = fetch('https://api.aliyundrive.com/adrive/v2/batch', {\n                    headers: {\n                        'User-Agent': PC_UA,\n                        'Referer': 'https://www.aliyundrive.com/',\n                        'authorization': reaccessTk,\n                        //getAccessToken\n                        'x-canary': 'client=web,app=share,version=v2.3.1',\n                        'x-share-token': sharetoken\n\n                    },\n                    body: {\n                        \"requests\": [{\n                            \"body\": {\n                                \"file_id\": fileId,\n                                \"share_id\": shareId,\n                                \"auto_rename\": true,\n                                \"to_parent_file_id\": \"root\",\n                                \"to_drive_id\": defdriveid\n                            },\n                            \"headers\": {\n                                \"Content-Type\": \"application/json\"\n                            },\n                            \"id\": \"0\",\n                            \"method\": \"POST\",\n                            \"url\": \"/file/copy\"\n                        }],\n                        \"resource\": \"file\"\n                    },\n                    method: 'POST'\n                });\n                //log('copy\\n' + json);\n                return JSON.parse(json).responses[0].body.file_id;\n            } catch (e) {\n                return \"\";\n            }\n        };\n\n        function open(fileId) {\n            try {\n                let json = \"\";\n                let number = 0;\n                do {\n                    json = fetch('https://open.aliyundrive.com/adrive/v1.0/openFile/getDownloadUrl', {\n                        headers: {\n                            'User-Agent': PC_UA,\n                            'Referer': 'https://www.aliyundrive.com/',\n                            'authorization': OpenToken.AccessTokenOpen\n                            //getAccessTokenOpen\n\n                        },\n                        body: {\n                            'file_id': fileId,\n                            'drive_id': defdriveid\n                        },\n                        method: 'POST'\n                    });\n                    //log('open\\n' + json);\n                    if (json.includes('\"url\":\"http')) {\n                        break;\n                    }\n                    if (json.includes(\"TooManyRequests\")) {\n                        //deletee(fileId);\n                        toast('Too Many Requests');\n                        //log('TooManyRequests');\n                        //return 'toast://请求太频繁';\n                    }\n                    if (getMyVar('redirect', '0') == '0') {\n                        oauthRequest();\n                    } else {\n                        refreshOpenToken();\n                    }\n                    //refreshOpenToken();\n                    number++\n                } while (number < 2);\n                //deletee(fileId);\n                return JSON.parse(json).url + ';{Referer@https://www.aliyundrive.com/}';\n            } catch (e) {\n                return 'hiker://empty';\n            }\n        };\n\n        function deletee(fileId) {\n\n            fetch('https://api.aliyundrive.com/adrive/v2/batch', {\n                headers: {\n                    'User-Agent': PC_UA,\n                    'Referer': 'https://www.aliyundrive.com/',\n                    'authorization': reaccessTk,\n                    'x-canary': 'client=web,app=share,version=v2.3.1',\n                    'x-share-token': sharetoken\n\n                },\n                body: {\n                    \"requests\": [{\n                        \"body\": {\n                            \"drive_id\": defdriveid,\n                            \"file_id\": fileId\n                        },\n                        \"headers\": {\n                            \"Content-Type\": \"application/json\"\n                        },\n                        \"id\": fileId,\n                        \"method\": \"POST\",\n                        \"url\": \"/file/delete\"\n                    }],\n                    \"resource\": \"file\"\n                },\n                method: 'POST'\n            });\n\n            /*\n            fetch('https://open.aliyundrive.com/adrive/v1.0/openFile/delete', {\n                headers: {\n                    'User-Agent': PC_UA,\n                    'Referer': 'https://www.aliyundrive.com/',\n                    'authorization': getItem('getAccessTokenOpen', ''),\n                    'x-share-token': sharetoken\n\n\n                },\n                body: {\n                    \"drive_id\": defdriveid,\n                    \"file_id\": fileId\n                },\n                method: 'POST'\n            });\n            */\n            //log('dele\\n' + json);\n        };\n\n\n        //处理视频  \n        var dsid = shareId;\n        var dfid = input;\n        if (resdriveid != null && resdriveid != \"\") {\n            defdriveid = resdriveid;\n        }\n        let fileId = copy(dfid);\n        var play = open(fileId);\n        if (fileId.length > 0) {\n            deletee(fileId);\n        }\n        if (zimu.length > 0) {\n            for (let i in zimu) {\n                var zimut = zimu[i].tit;\n                if (fname.includes(zimut) || zimut.includes(fname.substring(0, fname.lastIndexOf('.')))) {\n                    play = JSON.stringify({\n                        urls: [play.split(';{')[0]],\n                        headers: [{\n                            'Referer': 'https://www.aliyundrive.com/'\n                        }],\n                        subtitle: getsub(zimu[i].fid, zimu[i].ext)\n                    })\n                    break;\n                }\n            }\n        }\n    } else {\n        //普画  \n        var dsid = shareId;\n        var dfid = input;\n\n        var play = JSON.stringify(getAliUrl(\n            shareId,\n            input,\n            reftoken\n        ));\n\n    }\n}\n/*} else if (cate == 'image') {\n    //处理文档\n    accessTk();\n\n    var json = fetch('https://api.aliyundrive.com/v2/file/get_share_link_download_url', {\n        headers: {\n            'Content-Type': 'application/json',\n            'Authorization': accessTk(),\n            'X-Share-Token': sharetoken\n        },\n        body: '{\"share_id\":\"' + shareId + '\",\"expire_sec\": 600,\"file_id\":\"' + input + '\"}',\n        method: 'POST'\n    });\n\n    //log(json);\n\n    var loclink = JSON.parse(fetch(JSON.parse(json).url, {\n        headers: {\n            'User-Agent': MOBILE_UA,\n            'Content-Type': 'application/x-www-form-urlencoded',\n            'Referer': 'https://www.aliyundrive.com/'\n        },\n        redirect: false,\n        withStatusCode: true\n    })).headers.location[0];\n\n    //log(loclink);\n    if (cate == 'image') {\n        var play = 'pics://' + loclink + '@Referer=https://www.aliyundrive.com/';\n    } else {\n        var play = loclink + ';{Referer@https://www.aliyundrive.com/}';\n    }*/\nelse if (cate == 'audio') {\n    var json = fetch('https://api.aliyundrive.com/v2/file/get_share_link_download_url', {\n        headers: {\n            'Content-Type': 'application/json',\n            'Authorization': reaccessTk,\n            'X-Share-Token': sharetoken\n        },\n        body: '{\"share_id\":\"' + shareId + '\",\"get_audio_play_info\": true,\"file_id\":\"' + input + '\"}',\n        method: 'POST'\n    });\n    //log(json);\n    var play = JSON.parse(json).download_url + '#isMusic=true#;{Referer@https://www.aliyundrive.com/}';\n} else if (ftype.endsWith('.srt') || ftype.endsWith('.vtt') || ftype.endsWith('.ass')) {\n    var json = fetch('https://api.aliyundrive.com/v2/file/get_share_link_download_url', {\n        headers: {\n            'Content-Type': 'application/json',\n            'Authorization': reaccessTk,\n            'X-Share-Token': sharetoken\n        },\n        body: '{\"share_id\":\"' + shareId + '\",\"file_id\":\"' + input + '\"}',\n        method: 'POST'\n    });\n    //log(json);\n    var zimul = JSON.parse(json).download_url;\n    downloadFile(zimul, 'hiker://files/download/XYQ_subtitling' + fname.substring(fname.lastIndexOf(\".\")), {\n        'Referer': 'https://www.aliyundrive.com/'\n    });\n    var play = 'toast://字幕文件已下载到hiker://files/download/XYQ_subtitling' + fname.substring(fname.lastIndexOf(\".\"))\n    // + ';{Referer@https://www.aliyundrive.com/}';\n} else {\n    var play = 'toast://该格式暂未支持，目前只支持视频。'\n}"},{"col_type":"movie_3","name":"推送代码","path":"pushcode","rule":"js:\nlet push = JSON.stringify({\n    \"name\": pushname,\n    \"url\": tuisong.join('#'),\n    \"share_id\": shareId,\n    \"refresh_token\": reftoken\n}).replace(/\\&/g, '＆＆');\nif (tuisong.length > 0) {\n    items.unshift({\n        title: \"📽推送当前页音视频📺\",\n        url: $(push).lazyRule(() => {\n            return 'hiker://page/push?rule=XYQ推送&pushurl=' + encodeURIComponent(input);\n        }),\n        col_type: \"scroll_button\"\n    });\n    items.unshift({\n        title: (getItem('quality', '') == '1' ? '原画播√' : '转码播√'),\n        url: `hiker://empty@lazyRule=.js:getItem('quality','0')=='1'?setItem('quality','0'):setItem('quality','1');refreshPage();'toast://切换成功！'`,\n        col_type: 'scroll_button'\n    });\n    items.unshift({\n    title: (getItem('singlepush', '') == '1' ? '单推√' : '单推╳'),\n    url: `hiker://empty@lazyRule=.js:getItem('singlepush','0')=='1'?setItem('singlepush','0'):setItem('singlepush','1');refreshPage();'toast://切换成功！'`,\n    col_type: 'scroll_button'\n});\n}\n"},{"col_type":"movie_3","name":"登入","path":"Login","rule":"d.push({\n    title: \"⛅️点击我登录\",\n    url: $(\"hiker://empty###noRecordHistory##noHistory#\").rule(() => {\n        let d = [];\n        let ntoken = [];\n        if (fileExist(\"hiker://files/rules/icy/icy-ali-token.json\")) {\n            ntoken = JSON.parse(fetch('hiker://files/rules/icy/icy-ali-token.json', {}));\n        }\n        let url = 'https://www.aliyundrive.com/sign'\n        let js = $.toString((ntoken) => {\n            const tokenFunction = function() {\n                var token = JSON.parse(localStorage.getItem('token'))\n                if (token && token.user_id) {\n                    let alistfile = \"hiker://files/rules/icy/icy-ali-token.json\";\n                    ntoken[0] = token;\n                    fy_bridge_app.writeFile(alistfile, JSON.stringify(ntoken));\n                    localStorage.clear();\n                    alert('TOKEN获取成功，返回后刷新页面！');\n                    fy_bridge_app.parseLazyRule(`hiker://empty@lazyRule=.js:refreshX5WebView('');`);\n                    fy_bridge_app.back();\n                    return;\n                } else {\n                    token_timer();\n                }\n            }\n            var token_timer = function() {\n                setTimeout(tokenFunction, 500)\n            };\n            tokenFunction();\n        }, ntoken)\n        d.push({\n            url: url,\n            col_type: 'x5_webview_single',\n            desc: '100%&&float',\n            extra: {\n                canBack: true,\n                ua: PC_UA,\n                js: js\n            }\n        })\n        setResult(d);\n    }),\n    col_type: 'text_center_1'\n});"}],"title":"tvbox云盘推送","author":"tee&MrFly&小棉袄🌞&香雅情","version":9,"type":"video","url":"hiker://empty##fyclass","col_type":"text_1","class_name":"全部&喵搜&小纸条&找资源&小站&UP云搜&云盘资源&网盘资源&阿里盘贴吧&更多&云盘盘TG&懒狗TG&云盘发布TG&meow","class_url":"all&https://www.alipansou.com&https://u.gitcafe.net/&https://zhaoziyuan.me/so&https://www.pan666.cn/&https://www.upyunso.com&https://yunpan1.com/&https://aliwp.cn/&https://youhua.baidu.com/f?\nkw=阿里云盘&https://dalao.ru/w/&https://tx.me/s/YunPanPan&https://tx.me/s/vip115hot&https://tx.me/s/shareAliyun&https://meow.tg","area_name":"","area_url":"","sort_name":"","year_name":"","sort_url":"","year_url":"","find_rule":"js:\nlet random = 1;\n\nlet white = [\n    \"//tx.me/\",\n]\nlet d = [];\n\nif (!fileExist(\"hiker://files/rules/icy/icy-ali-token.json\")) {\n    eval(JSON.parse(fetch(\"hiker://page/Login\")).rule);\n    setResult(d);\n} else {\n    let ntoken = JSON.parse(fetch('hiker://files/rules/icy/icy-ali-token.json', {}));\n    if (ntoken[0].refresh_token) {\n        function loadUrl(u) {\n            let desc = \"auto\";\n            for (let it of white) {\n                if (u.includes(it)) {\n                    desc = \"100%&&float\";\n                }\n            }\n            if (getAppVersion() >= 3018) {\n                desc = \"float&&top\";\n            }\n            setResult([{\n                col_type: \"x5_webview_single\",\n                url: u,\n                desc: desc,\n                extra: {\n                    canBack: true,\n                    urlInterceptor: $.toString((myrule) => {\n                        if (input.includes('checkurl?url=') && input.includes('&urlrefer')) {\n                            input = decodeURIComponent(input.split('&urlrefer')[0].split('checkurl?url=')[1]);\n                            //log('贴吧'+input);\n                        }\n                        if (input.startsWith('https://www.aliyundrive.com/s/') || input.startsWith('magnet:')) {\n                            //fba.fetch(input, {});\n                            clearMyVar('name');\n                            return $.toString((url, myrule) => {\n                                fba.open(JSON.stringify({\n                                    rule: myrule,\n                                    url: 'hiker://page/push?rule=' + myrule + '&url=hiker://empty##' + encodeURIComponent(url) + '???fypage'\n                                }));\n                            }, input, myrule)\n                        }\n                    }, MY_RULE.title),\n                    ua: MOBILE_UA\n                }\n            }])\n        };\n        let u = MY_URL.split(\"##\")[1];\n        if (u == \"all\") {\n            let cls = getMyVar(\"cls\", \"\");\n            if (cls) {\n                u = cls;\n                loadUrl(u);\n                clearMyVar(\"cls\");\n            } else {\n                let r = JSON.parse(fetch(\"hiker://home@\" + MY_RULE.title));\n                let cn = r.class_name.split(\"&\");\n                let cu = r.class_url.split(\"&\");\n                let arr = [];\n\n                for (let i = 1; i < cn.length; i++) {\n                    arr.push({\n                        title: cn[i],\n                        url: $().lazyRule((u) => {\n                            putMyVar(\"cls\", u);\n                            //refreshX5Desc(\"top&&float\");\n                            refreshPage();\n                            return \"hiker://empty\";\n                        }, cu[i]),\n                        col_type: \"text_2\",\n                        desc: \"\",\n                        pic_url: \"\"\n                    });\n                }\n                refreshX5Desc(\"0&&float\");\n                setResult(arr);\n            }\n        } else {\n            loadUrl(u);\n        }\n    } else {\n        eval(JSON.parse(fetch(\"hiker://page/Login\")).rule);\n        setResult(d);\n    }\n}","searchFind":"","search_url":"","group":"②推送","detail_col_type":"movie_1","detail_find_rule":"","sdetail_col_type":"movie_1","sdetail_find_rule":"","ua":"mobile","preRule":"let reaccessTk = getMyVar(\"aliaccessTk\", '');\nlet timeToken = getMyVar('timeToken', '0');\nif (reaccessTk == '' || (parseInt(timeToken) - parseInt(new Date().getTime() / 1000)).toString() <= 600) {\n    let ntoken = [];\n    let reftoken = \"\";\n    if (!fileExist(\"hiker://files/rules/icy/icy-ali-token.json\")) {\n        toast('用户信息获取失败，请登入账号。');\n    } else {\n        ntoken = JSON.parse(fetch('hiker://files/rules/icy/icy-ali-token.json', {}));\n        if (ntoken[0].refresh_token) {\n            reftoken = ntoken[0].refresh_token;\n        } else {\n            toast('用户信息获取失败，请登入账号。');\n        }\n    }\n    if (reftoken.length == 32) {\n        var refresh = fetch('https://auth.aliyundrive.com/v2/account/token', {\n            headers: {\n                'Content-Type': 'application/json',\n                'User-Agent': PC_UA,\n                'Referer': 'https://www.aliyundrive.com/'\n            },\n            body: '{\"refresh_token\":\"' + reftoken + '\",\"grant_type\":\"refresh_token\"}',\n            method: 'POST'\n        });\n        ntoken[0] = JSON.parse(refresh);\n        writeFile(\"hiker://files/rules/icy/icy-ali-token.json\", JSON.stringify(ntoken));\n        log('运行预处理');\n        if (!fileExist(\"hiker://files/rules/icy/icy-ali-token.json\") || refresh.length > 300) {\n            var refresh = fetch('hiker://files/rules/icy/icy-ali-token.json', {});\n            putMyVar('timeToken', (parseInt(JSON.parse(refresh)[0].expires_in) + parseInt(new Date().getTime() / 1000)).toString());\n            let defdriveid = JSON.parse(refresh)[0].default_drive_id;\n            putMyVar('defdriveid', defdriveid);\n            var accessTk = JSON.parse(refresh)[0].token_type + ' ' + JSON.parse(refresh)[0].access_token;\n            putMyVar(\"aliaccessTk\", accessTk);\n            let userresinfo = JSON.parse(fetch(\"https://user.aliyundrive.com/v2/user/get\", {\n                headers: {\n                    'content-type': 'application/json',\n                    'User-Agent': PC_UA,\n                    \"authorization\": accessTk,\n                    'Referer': 'https://www.aliyundrive.com/'\n                },\n                body: {},\n                method: 'POST'\n            }));\n            if (userresinfo.resource_drive_id) {\n                let resdriveid = userresinfo.resource_drive_id;\n                putMyVar('resdriveid', resdriveid);\n            }\n        }\n    }\n}","pages":"[{\"col_type\":\"movie_3\",\"name\":\"推送\",\"path\":\"push\",\"rule\":\"js:\\n//log(MY_URL);\\nvar items = [];\\nvar realurl = MY_URL.split('##')[1].split('???')[0];\\nif (MY_PAGE == 1) {\\n    items.push({\\n        title: \\\"📽 推送到TVBox 📺\\\",\\n        url: $(realurl).lazyRule(() => {\\n            input = decodeURIComponent(input);\\n            return 'hiker://page/push?rule=XYQ推送&pushurl=' + encodeURIComponent(input);\\n        }),\\n        col_type: \\\"text_center_1\\\",\\n        desc: \\\"\\\",\\n        pic_url: \\\"\\\"\\n    });\\n}\\nif (decodeURIComponent(realurl).includes('www.aliyundrive') && !realurl.includes('%3B%7B')) {\\n    eval(JSON.parse(fetch('hiker://page/sharid', {})).rule)\\n}\\nsetResult(items);\"},{\"col_type\":\"movie_3\",\"name\":\"分享资源一级\",\"path\":\"sharid\",\"rule\":\"js:\\n//var items = [];\\nfunction formatDate(_date, _fmt) {\\n    let fmt = _fmt || \\\"yyyy-MM-dd HH:mm:ss\\\";\\n    const date = !isNaN(_date) ? new Date(_date * 1000) : new Date(_date);\\n    const o = {\\n        \\\"M+\\\": date.getMonth() + 1, //月份 \\n        \\\"d+\\\": date.getDate(), //日 \\n        \\\"h+\\\": date.getHours() % 12 == 0 ? 12 : date.getHours() % 12,\\n        \\\"H+\\\": date.getHours(), //小时 \\n        \\\"m+\\\": date.getMinutes(), //分 \\n        \\\"s+\\\": date.getSeconds(), //秒 \\n        \\\"q+\\\": Math.floor((date.getMonth() + 3) / 3), //季度 \\n        \\\"S\\\": date.getMilliseconds() //毫秒 \\n    };\\n    if (/(y+)/.test(fmt)) {\\n        fmt = fmt.replace(RegExp.$1, (date.getFullYear() + \\\"\\\").substr(4 - RegExp.$1.length));\\n    }\\n    for (let k in o) {\\n        if (new RegExp(\\\"(\\\" + k + \\\")\\\").test(fmt)) {\\n            fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : ((\\\"00\\\" + o[k]).substr((\\\"\\\" + o[k]).length)));\\n        }\\n    }\\n    return fmt;\\n};\\n\\nfunction formatSize(size) {\\n    if (!size) {\\n        return '';\\n    }\\n    const units = ['B', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];\\n    let i = 0;\\n    while (size >= 1024) {\\n        size /= 1024;\\n        i++;\\n    }\\n    size = i ? Number(size.toFixed(2)) : size;\\n    return `${size} ${units[i]}`;\\n}\\n//log(realurl);\\n\\nif (MY_PAGE == 1) {\\n    clearMyVar('nextpage');\\n}\\nif (MY_PAGE > 1 && getMyVar('nextpage', '') == '') {\\n    log('没有下一页');\\n} else {\\n    try {\\n        //var reftoken = JSON.parse(fetch('hiker://files/rules/xyq/alitoken.json', {})).refresh_token;\\n        var reftoken = JSON.parse(fetch('hiker://files/rules/icy/icy-ali-token.json', {}))[0].refresh_token;\\n        var shareId = decodeURIComponent(realurl).split('com/s/')[1].substring(0, 11);\\n        let getshar = fetch('https://api.aliyundrive.com/adrive/v3/share_link/get_share_by_anonymous', {\\n            headers: {\\n                'Content-Type': 'application/json'\\n            },\\n            body: '{\\\"share_id\\\":\\\"' + shareId + '\\\"}',\\n            method: 'POST'\\n        });\\n        if (getshar.includes(\\\"share_link is forbidden\\\")) {\\n            items.push({\\n                title: '文件违规，根据相关法律法规要求，该文件已禁止访问。',\\n                url: decodeURIComponent(getResCode().split('##')[1]),\\n                col_type: 'text_center_1'\\n            });\\n        }\\n        if (getshar.includes(\\\"share_link is cancelled\\\") || getshar.includes(\\\"share_link is expired\\\")) {\\n            items.push({\\n                title: '来晚啦，该分享已失效。',\\n                url: decodeURIComponent(getResCode().split('##')[1]),\\n                col_type: 'text_center_1'\\n            });\\n        }\\n        if (getshar.includes(\\\"share_link cannot be found\\\")) {\\n            items.push({\\n                title: '你打开的链接有误，请重试。',\\n                url: decodeURIComponent(getResCode().split('##')[1]),\\n                col_type: 'text_center_1'\\n            });\\n        }\\n\\n        let pushname = JSON.parse(getshar).file_infos[0].file_name;\\n        //var listyp = JSON.parse(getshar).file_infos[0].type;\\n        //var pfileid = JSON.parse(getshar).file_infos[0].file_id;\\n\\n        var sharetoken = JSON.parse(fetch('https://api.aliyundrive.com/v2/share_link/get_share_token', {\\n            headers: {\\n                'Content-Type': 'application/json'\\n            },\\n            body: '{\\\"share_pwd\\\":\\\"\\\",\\\"share_id\\\":\\\"' + shareId + '\\\"}',\\n            method: 'POST'\\n        })).share_token;\\n        //log(sharetoken);\\n\\n        let next = getMyVar('nextpage', '') != '' ? ',\\\"marker\\\":\\\"' + getMyVar('nextpage') + '\\\"' : '';\\n        if (!decodeURIComponent(realurl).includes('/folder/')) {\\n            //if(!listyp == 'folder'){\\n            var rescod = fetch('https://api.aliyundrive.com/adrive/v3/file/list', {\\n                headers: {\\n                    'Content-Type': 'application/json',\\n                    'X-Share-Token': sharetoken\\n                },\\n                body: '{\\\"share_id\\\":\\\"' + shareId + '\\\",\\\"parent_file_id\\\":\\\"root\\\",\\\"limit\\\":100,\\\"image_thumbnail_process\\\":\\\"image/resize,w_160/format,jpeg\\\",\\\"image_url_process\\\":\\\"image/resize,w_1920/format,jpeg\\\",\\\"video_thumbnail_process\\\":\\\"video/snapshot,t_1000,f_jpg,ar_auto,w_300\\\",\\\"order_by\\\":\\\"name\\\",\\\"order_direction\\\":\\\"ASC\\\"' + next + '}',\\n                method: 'POST'\\n            });\\n            //log(rescod);\\n            if (rescod.includes(\\\"ParamFlowException\\\")) {\\n                refreshPage();\\n            }\\n            var listyp = JSON.parse(rescod).items[0].type;\\n            var pfileid = JSON.parse(rescod).items[0].file_id;\\n        } else {\\n            var listyp = 'folder';\\n            var pfileid = decodeURIComponent(realurl).split('folder/')[1]\\n\\n        }\\n        //log(html);\\n        if (listyp == 'folder') {\\n            var rescod = fetch('https://api.aliyundrive.com/adrive/v3/file/list', {\\n                headers: {\\n                    'Content-Type': 'application/json',\\n                    'X-Share-Token': sharetoken\\n                },\\n                body: '{\\\"share_id\\\":\\\"' + shareId + '\\\",\\\"parent_file_id\\\":\\\"' + pfileid + '\\\",\\\"limit\\\":100,\\\"image_thumbnail_process\\\":\\\"image/resize,w_160/format,jpeg\\\",\\\"image_url_process\\\":\\\"image\\\\/resize,w_1920/format,jpeg\\\",\\\"video_thumbnail_process\\\":\\\"video/snapshot,t_1000,f_jpg,ar_auto,w_300\\\",\\\"order_by\\\":\\\"name\\\",\\\"order_direction\\\":\\\"ASC\\\"' + next + '}',\\n                method: 'POST'\\n            });\\n            if (rescod.includes(\\\"ParamFlowException\\\")) {\\n                refreshPage();\\n            }\\n        } //取文件夹\\n        //log(rescod);\\n        if (JSON.parse(rescod).next_marker) {\\n            let marker = JSON.parse(rescod).next_marker;\\n            if (marker.length > 10) {\\n                putMyVar('nextpage', marker);\\n            } else {\\n                clearMyVar('nextpage');\\n            }\\n        }\\n        var conts = JSON.parse(rescod).items;\\n        var dongtai = JSON.parse(fetch('hiker://page/lazyurl', {})).rule.toString();\\n        var tuisong = [];\\n        var zimu = [];\\n        for (let i in conts) {\\n            //var listyp = conts[i].type;\\n            if (conts[i].type != 'folder') {\\n                let fname = conts[i].name;\\n                let ftype = fname.toLowerCase();\\n                let cate = conts[i].category;\\n                if (ftype.endsWith('.srt') || ftype.endsWith('.vtt') || ftype.endsWith('.ass')) {\\n                    zimu.push({\\n                        tit: fname.substring(0, fname.lastIndexOf(\\\".\\\")),\\n                        ext: conts[i].file_extension,\\n                        fid: conts[i].file_id\\n                    });\\n                };\\n                if (cate == 'video' || cate == 'audio') {\\n                    tuisong.push(\\n                        fname.replace(/\\\\#/g, '_').replace(/\\\\$/g, '_') + '$' + cate + '|' + conts[i].file_id\\n                    );\\n                };\\n            }\\n        }\\n        for (var i in conts) {\\n            var listyp = conts[i].type;\\n            if (listyp != 'folder') {\\n                var cate = conts[i].category;\\n                var fname = conts[i].name;\\n                if (cate == 'video') {\\n                    var title = '📺' + conts[i].name;\\n                } else if (cate == 'doc') {\\n                    var title = '📖' + conts[i].name;\\n                } else if (cate == 'image') {\\n                    var title = '🖼' + conts[i].name;\\n                } else if (cate == 'zip') {\\n                    var title = '📦' + conts[i].name;\\n                } else {\\n                    var title = conts[i].name\\n                }\\n                items.push({\\n                    title: title,\\n                    url: $(conts[i].file_id).lazyRule((shareId, dongtai, cate, fname, reftoken, zimu) => {\\n                        if (getItem('singlepush', '') == '1') {\\n                            return 'hiker://page/push?rule=XYQ推送&pushurl=' + encodeURIComponent(JSON.stringify({\\n                                \\\"name\\\": fname,\\n                                \\\"refresh_token\\\": reftoken,\\n                                \\\"url\\\": fname.replace(/\\\\#/g, '_').replace(/\\\\$/g, '_') + '$' + cate + '|' + input,\\n                                \\\"share_id\\\": shareId\\n                            }));\\n                        } else {\\n                            eval(dongtai);\\n                            return play\\n                        }\\n                    }, shareId, dongtai, cate, fname, reftoken, zimu),\\n                    desc: formatDate(conts[i].updated_at) + '  ' + formatSize(conts[i].size),\\n                    extra: {\\n                        longClick: [{\\n                            title: '推送到TVBox',\\n                            js: $.toString((shareId, fileid, cate, fname, reftoken) => {\\n                                return 'hiker://page/push?rule=XYQ推送&pushurl=' + encodeURIComponent(JSON.stringify({\\n                                    \\\"name\\\": fname,\\n                                    \\\"refresh_token\\\": reftoken,\\n                                    \\\"url\\\": fname.replace(/\\\\#/g, '_').replace(/\\\\$/g, '_') + '$' + cate + '|' + fileid,\\n                                    \\\"share_id\\\": shareId\\n                                }));\\n                            }, shareId, conts[i].file_id, cate, fname, reftoken)\\n                        }],\\n                        id: conts[i].file_id\\n                    },\\n                    col_type: 'text_1'\\n\\n                });\\n            } else {\\n                items.push({\\n                    title: '📂' + conts[i].name,\\n                    url: $('hiker://empty' + conts[i].file_id + '???fypage').rule((shareId, sharetoken, pushname) => {\\n                        eval(JSON.parse(fetch('hiker://page/ruleloop', {})).rule);\\n                    }, shareId, sharetoken, conts[i].name),\\n                    col_type: 'flex_button'\\n                });\\n\\n            } //end if\\n        } //end for i\\n        //log(tuisong);\\n        //let pushname = JSON.parse(rescod).items[0].name;\\n        eval(JSON.parse(fetch('hiker://page/pushcode', {})).rule);\\n\\n    } catch (e) {\\n        /*\\n        items.push({\\n            title: '欧欧，报错了。',\\n            url: decodeURIComponent(getResCode().split('##')[1]),\\n            col_type: 'text_center_1'\\n        });\\n        */\\n    }\\n}\\n/*\\nsetHomeResult({\\n    data: items\\n});\\n*/\"},{\"col_type\":\"movie_3\",\"name\":\"分享资源嵌套\",\"path\":\"ruleloop\",\"rule\":\"var items = [];\\n\\nfunction formatDate(_date, _fmt) {\\n    let fmt = _fmt || \\\"yyyy-MM-dd HH:mm:ss\\\";\\n    const date = !isNaN(_date) ? new Date(_date * 1000) : new Date(_date);\\n    const o = {\\n        \\\"M+\\\": date.getMonth() + 1, //月份 \\n        \\\"d+\\\": date.getDate(), //日 \\n        \\\"h+\\\": date.getHours() % 12 == 0 ? 12 : date.getHours() % 12,\\n        \\\"H+\\\": date.getHours(), //小时 \\n        \\\"m+\\\": date.getMinutes(), //分 \\n        \\\"s+\\\": date.getSeconds(), //秒 \\n        \\\"q+\\\": Math.floor((date.getMonth() + 3) / 3), //季度 \\n        \\\"S\\\": date.getMilliseconds() //毫秒 \\n    };\\n    if (/(y+)/.test(fmt)) {\\n        fmt = fmt.replace(RegExp.$1, (date.getFullYear() + \\\"\\\").substr(4 - RegExp.$1.length));\\n    }\\n    for (let k in o) {\\n        if (new RegExp(\\\"(\\\" + k + \\\")\\\").test(fmt)) {\\n            fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : ((\\\"00\\\" + o[k]).substr((\\\"\\\" + o[k]).length)));\\n        }\\n    }\\n    return fmt;\\n};\\n\\nfunction formatSize(size) {\\n    if (!size) {\\n        return '';\\n    }\\n    const units = ['B', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];\\n    let i = 0;\\n    while (size >= 1024) {\\n        size /= 1024;\\n        i++;\\n    }\\n    size = i ? Number(size.toFixed(2)) : size;\\n    return `${size} ${units[i]}`;\\n}\\n//let tvip = getItem('hikertvboxset', '');\\n\\n//log(getResCode());\\nif (MY_PAGE == 1) {\\n    clearMyVar('nextpage');\\n    items.unshift({\\n        title: \\\"📽推送当前文件夹📺\\\",\\n        url: $('https://www.aliyundrive.com/s/' + shareId + '/folder/' + getResCode().split('???')[0]).lazyRule(() => {\\n            return 'hiker://page/push?rule=XYQ推送&pushurl=' + encodeURIComponent(input);\\n        }),\\n        col_type: \\\"scroll_button\\\"\\n    });\\n}\\nif (MY_PAGE > 1 && getMyVar('nextpage', '') == '') {\\n    log('没有下一页');\\n} else {\\n    let reftoken = JSON.parse(fetch('hiker://files/rules/icy/icy-ali-token.json', {}))[0].refresh_token;\\n\\n    let next = getMyVar('nextpage', '') != '' ? ',\\\"marker\\\":\\\"' + getMyVar('nextpage') + '\\\"' : '';\\n\\n    var rescod = fetch('https://api.aliyundrive.com/adrive/v3/file/list', {\\n        headers: {\\n            'Content-Type': 'application/json',\\n            'X-Share-Token': sharetoken\\n        },\\n        body: '{\\\"share_id\\\":\\\"' + shareId + '\\\",\\\"parent_file_id\\\":\\\"' + getResCode().split('???')[0] + '\\\",\\\"limit\\\":100,\\\"image_thumbnail_process\\\":\\\"image/resize,w_160/format,jpeg\\\",\\\"image_url_process\\\":\\\"image\\\\/resize,w_1920/format,jpeg\\\",\\\"video_thumbnail_process\\\":\\\"video/snapshot,t_1000,f_jpg,ar_auto,w_300\\\",\\\"order_by\\\":\\\"name\\\",\\\"order_direction\\\":\\\"ASC\\\"' + next + '}',\\n        method: 'POST'\\n    });\\n    //log(rescod);\\n    if (JSON.parse(rescod).next_marker) {\\n        let marker = JSON.parse(rescod).next_marker;\\n        if (marker.length > 10) {\\n            putMyVar('nextpage', marker);\\n        } else {\\n            clearMyVar('nextpage');\\n        }\\n    }\\n    var conts = JSON.parse(rescod).items;\\n    var dongtai = JSON.parse(fetch('hiker://page/lazyurl', {})).rule.toString();\\n    var tuisong = [];\\n    var zimu = [];\\n    for (let i in conts) {\\n        //var listyp = conts[i].type;\\n        if (conts[i].type != 'folder') {\\n            let fname = conts[i].name;\\n            let ftype = fname.toLowerCase();\\n            let cate = conts[i].category;\\n            if (ftype.endsWith('.srt') || ftype.endsWith('.vtt') || ftype.endsWith('.ass')) {\\n                zimu.push({\\n                    tit: fname.substring(0, fname.lastIndexOf(\\\".\\\")),\\n                    ext: conts[i].file_extension,\\n                    fid: conts[i].file_id\\n                });\\n            };\\n            if (cate == 'video' || cate == 'audio') {\\n                tuisong.push(\\n                    fname.replace(/\\\\#/g, '_').replace(/\\\\$/g, '_') + '$' + cate + '|' + conts[i].file_id\\n                );\\n            };\\n        }\\n    }\\n    for (var i in conts) {\\n\\n        var listyp = conts[i].type;\\n        if (listyp != 'folder') {\\n            var cate = conts[i].category;\\n            var fname = conts[i].name;\\n            if (cate == 'video') {\\n                var title = '📺' + conts[i].name;\\n            } else if (cate == 'doc') {\\n                var title = '📖' + conts[i].name;\\n            } else if (cate == 'image') {\\n                var title = '🖼' + conts[i].name;\\n            } else if (cate == 'zip') {\\n                var title = '📦' + conts[i].name;\\n            } else {\\n                var title = conts[i].name\\n            }\\n            items.push({\\n                title: title,\\n                url: $(conts[i].file_id).lazyRule((shareId, dongtai, cate, fname, reftoken, zimu) => {\\n                    if (getItem('singlepush', '') == '1') {\\n                        return 'hiker://page/push?rule=XYQ推送&pushurl=' + encodeURIComponent(JSON.stringify({\\n                            \\\"name\\\": fname,\\n                            \\\"refresh_token\\\": reftoken,\\n                            \\\"url\\\": fname.replace(/\\\\#/g, '_').replace(/\\\\$/g, '_') + '$' + cate + '|' + input,\\n                            \\\"share_id\\\": shareId\\n                        }));\\n                    } else {\\n                        eval(dongtai);\\n                        return play\\n                    }\\n                }, shareId, dongtai, cate, fname, reftoken, zimu),\\n                desc: formatDate(conts[i].updated_at) + '  ' + formatSize(conts[i].size),\\n                extra: {\\n                    longClick: [{\\n                        title: '推送到TVBox',\\n                        js: $.toString((shareId, fileid, cate, fname, reftoken) => {\\n                            return 'hiker://page/push?rule=XYQ推送&pushurl=' + encodeURIComponent(JSON.stringify({\\n                                \\\"name\\\": fname,\\n                                \\\"refresh_token\\\": reftoken,\\n                                \\\"url\\\": fname.replace(/\\\\#/g, '_').replace(/\\\\$/g, '_') + '$' + cate + '|' + fileid,\\n                                \\\"share_id\\\": shareId\\n                            }));\\n                        }, shareId, conts[i].file_id, cate, fname, reftoken)\\n                    }],\\n                    id: conts[i].file_id\\n                },\\n                col_type: 'text_1'\\n\\n            });\\n            if (cate == 'video' || cate == 'audio') {\\n                tuisong.push(\\n                    title.replace(/\\\\#/g, '_').replace(/\\\\$/g, '_') + '$' + cate + '|' + conts[i].file_id\\n                );\\n            }\\n        } else {\\n            items.push({\\n                title: '📂' + conts[i].name,\\n                url: $('hiker://empty' + conts[i].file_id + '???fypage').rule((shareId, sharetoken, pushname) => {\\n                    eval(JSON.parse(fetch('hiker://page/ruleloop', {})).rule);\\n                }, shareId, sharetoken, conts[i].name),\\n                col_type: 'flex_button'\\n            });\\n\\n        } //end if\\n\\n\\n    }\\n    eval(JSON.parse(fetch('hiker://page/pushcode', {})).rule);\\n}\\nsetHomeResult({\\n    data: items\\n});\"},{\"col_type\":\"movie_3\",\"name\":\"分享资源动态解析\",\"path\":\"lazyurl\",\"rule\":\"var defdriveid = getMyVar('defdriveid', ''),\\n    reaccessTk = getMyVar(\\\"aliaccessTk\\\", ''),\\n    timeToken = getMyVar('timeToken', '0'),\\n    stToken = getMyVar('stToken', '0'),\\n    shareiid = getMyVar('shareiid', shareId),\\n    sharetoken = getItem('sharetoken', ''),\\n    resdriveid = getMyVar('resdriveid', ''),\\n    ftype = fname.toLowerCase();\\n//log((parseInt(timeToken) - parseInt(new Date().getTime() / 1000)).toString());\\nfunction accessTk() {\\n    if (reaccessTk == '' || (parseInt(timeToken) - parseInt(new Date().getTime() / 1000)).toString() <= 600) {\\n        log('刷新reaccessTk');\\n        let ntoken = JSON.parse(fetch('hiker://files/rules/icy/icy-ali-token.json', {}));\\n        var reftoken = ntoken[0].refresh_token;\\n        let refresh = fetch('https://auth.aliyundrive.com/v2/account/token', {\\n            headers: {\\n                'User-Agent': PC_UA,\\n                'Content-Type': 'application/json',\\n                'Referer': 'https://www.aliyundrive.com/'\\n            },\\n            body: '{\\\"refresh_token\\\":\\\"' + reftoken + '\\\",\\\"grant_type\\\":\\\"refresh_token\\\"}',\\n            method: 'POST'\\n        });\\n        ntoken[0] = JSON.parse(refresh);\\n        if (!fileExist(\\\"hiker://files/rules/icy/icy-ali-token.json\\\") || refresh.length > 300) {\\n            writeFile(\\\"hiker://files/rules/icy/icy-ali-token.json\\\", JSON.stringify(ntoken));\\n        }\\n        putMyVar('timeToken', (parseInt(JSON.parse(refresh).expires_in) + parseInt(new Date().getTime() / 1000)).toString());\\n        defdriveid = JSON.parse(refresh).default_drive_id;\\n        putMyVar('defdriveid', defdriveid);\\n        reaccessTk = JSON.parse(refresh).token_type + ' ' + JSON.parse(refresh).access_token;\\n        putMyVar(\\\"aliaccessTk\\\", reaccessTk);\\n        \\n    }\\n};\\nfunction resourceID() {\\n    let userresinfo = JSON.parse(fetch(\\\"https://user.aliyundrive.com/v2/user/get\\\", {\\n        headers: {\\n            'content-type': 'application/json',\\n            'User-Agent': PC_UA,\\n            \\\"authorization\\\": reaccessTk,\\n            'Referer': 'https://www.aliyundrive.com/'\\n        },\\n        body: {},\\n        method: 'POST'\\n    }));\\n    if (userresinfo.resource_drive_id) {\\n        resdriveid = userresinfo.resource_drive_id;\\n        putMyVar('resdriveid', resdriveid);\\n    }\\n}\\naccessTk();\\nresourceID();\\n//刷新sharetoken\\nif (shareiid != shareId || (parseInt(stToken) - parseInt(new Date().getTime() / 1000)).toString() <= 600) {\\n    var sharetk = fetch('https://api.aliyundrive.com/v2/share_link/get_share_token', {\\n        headers: {\\n            'User-Agent': PC_UA,\\n            'Content-Type': 'application/json'\\n        },\\n        body: '{\\\"share_pwd\\\":\\\"\\\",\\\"share_id\\\":\\\"' + shareId + '\\\"}',\\n        method: 'POST'\\n    });\\n    log('刷新sharetoken');\\n    sharetoken = JSON.parse(sharetk).share_token;\\n    setItem('sharetoken', JSON.parse(sharetk).share_token);\\n    putMyVar('stToken', (parseInt(JSON.parse(sharetk).expires_in) + parseInt(new Date().getTime() / 1000)).toString());\\n    putMyVar('shareiid', shareId);\\n}\\n\\nconst transcoding = {\\n    UHD: \\\"4K 超清\\\",\\n    QHD: \\\"2K 超清\\\",\\n    FHD: \\\"1080 全高清\\\",\\n    HD: \\\"720 高清\\\",\\n    SD: \\\"540 标清\\\",\\n    LD: \\\"360 流畅\\\"\\n};\\nif (!fileExist(\\\"hiker://files/rules/icy/icy-ali-OpenToken.json\\\")) {\\n    var OpenToken = {\\n        'RefreshTokenOpen': '',\\n        'AccessTokenOpen': ''\\n    };\\n} else {\\n    var OpenToken = JSON.parse(fetch('hiker://files/rules/icy/icy-ali-OpenToken.json', {}));\\n}\\n//var reftoken = JSON.parse(fetch('hiker://files/rules/icy/icy-ali-token.json', {}))[0].refresh_token;\\nfunction getsub(zmfid, zmext) {\\n    try {\\n        var json = fetch('https://api.aliyundrive.com/v2/file/get_share_link_download_url', {\\n            headers: {\\n                'Content-Type': 'application/json',\\n                'Authorization': reaccessTk,\\n                'X-Share-Token': sharetoken\\n            },\\n            body: '{\\\"share_id\\\":\\\"' + shareId + '\\\",\\\"file_id\\\":\\\"' + zmfid + '\\\"}',\\n            method: 'POST'\\n        });\\n        //log(json);\\n        let zimul = JSON.parse(json).download_url;\\n        downloadFile(zimul, 'hiker://files/download/subtitling.' + zmext, {\\n            'Referer': 'https://www.aliyundrive.com/'\\n        });\\n        return getPath('hiker://files/download/subtitling.' + zmext)\\n    } catch (e) {\\n        return \\\"\\\";\\n    }\\n}\\n\\nfunction aliSharePlayUrl(share_id, file_id, alitoken) {\\n    try {\\n        function getNowTime() {\\n            const yy = new Date().getFullYear()\\n            const MM = (new Date().getMonth() + 1) < 10 ? '0' + (new Date().getMonth() + 1) : (new Date().getMonth() + 1)\\n            const dd = new Date().getDate() < 10 ? '0' + new Date().getDate() : new Date().getDate()\\n            const HH = new Date().getHours() < 10 ? '0' + new Date().getHours() : new Date().getHours()\\n            const mm = new Date().getMinutes() < 10 ? '0' + new Date().getMinutes() : new Date().getMinutes()\\n            return yy + '' + dd + '' + HH + '' + MM + '' + mm\\n        }\\n\\n        let sharetoken = JSON.parse(request('https://api.aliyundrive.com/v2/share_link/get_share_token', {\\n            body: {\\n                \\\"share_pwd\\\": \\\"\\\",\\n                \\\"share_id\\\": share_id\\n            },\\n            method: 'POST',\\n            timeout: 3000\\n        })).share_token;\\n\\n        let headers = {\\n            'content-type': 'application/json;charset=UTF-8',\\n            \\\"origin\\\": \\\"https://www.aliyundrive.com\\\",\\n            \\\"referer\\\": \\\"https://www.aliyundrive.com/\\\",\\n            //\\\"user-agent\\\": \\\"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/110.0.0.0 Safari/537.36\\\",\\n            \\\"user-agent\\\": PC_UA,\\n            \\\"x-canary\\\": \\\"client=web,app=adrive,version=v3.1.0\\\"\\n        };\\n        let nowtime = Date.now();\\n        let oldtime = parseInt(getMyVar('userinfoChecktime', '0').replace('time', ''));\\n        let userinfo;\\n        let aliuserinfo = storage0.getMyVar('aliuserinfo');\\n        if (aliuserinfo && aliuserinfo.user_id && nowtime < (oldtime + 1 * 60 * 60 * 1000)) {\\n            userinfo = aliuserinfo;\\n        } else {\\n            userinfo = JSON.parse(request('https://auth.aliyundrive.com/v2/account/token', {\\n                headers: headers,\\n                body: {\\n                    \\\"refresh_token\\\": alitoken,\\n                    \\\"grant_type\\\": \\\"refresh_token\\\"\\n                },\\n                method: 'POST',\\n                timeout: 3000\\n            }));\\n            storage0.putMyVar('aliuserinfo', userinfo);\\n            putMyVar('userinfoChecktime', nowtime + 'time');\\n        }\\n        let authorization = 'Bearer ' + userinfo.access_token;\\n        let deviceId = userinfo.device_id;\\n        let userId = userinfo.user_id;\\n        let signature;\\n\\n        let as = justTestSign(\\\"5dde4e1bdf9e4966b387ba58f4b3fdc3\\\", deviceId, userId);\\n        //log(a);\\n        let bp = as.split(\\\"##\\\");\\n        var sign = bp[0];\\n        var pubKey = bp[bp.length - 1];\\n\\n        let i = 0;\\n        do {\\n\\n            let sess = fetch('https://api.aliyundrive.com/users/v1/users/device/create_session', {\\n                headers: {\\n                    'Content-Type': 'application/json',\\n                    'User-Agent': PC_UA,\\n                    'Referer': 'https://www.aliyundrive.com/',\\n                    'Authorization': authorization,\\n                    'X-Share-Token': sharetoken,\\n                    'x-device-id': deviceId,\\n                    'x-signature': sign\\n                },\\n                body: '{\\\"deviceName\\\":\\\"Chrome浏览器\\\",\\\"modelName\\\":\\\"Windows网页版\\\",\\\"nonce\\\":0,\\\"pubKey\\\":\\\"' + pubKey + '\\\",\\\"refreshToken\\\":\\\"' + alitoken + '\\\"}',\\n                method: 'POST'\\n            });\\n            if (sess.includes('success')) {\\n                break;\\n            }\\n            log('create_session ' + sess);\\n            as = justTestSign(\\\"5dde4e1bdf9e4966b387ba58f4b3fdc3\\\", deviceId, userId);\\n            //log(a);\\n            bp = as.split(\\\"##\\\");\\n            sign = bp[0];\\n            pubKey = bp[bp.length - 1];\\n            i++;\\n        } while (i < 5);\\n\\n        signature = sign;\\n        headers['authorization'] = authorization;\\n        headers['x-device-id'] = deviceId;\\n        headers['x-signature'] = signature;\\n        let aliyunUrl = [];\\n        headers['x-share-token'] = sharetoken;\\n        headers['fileid'] = userId;\\n        let data = {\\n            \\\"category\\\": \\\"live_transcoding\\\",\\n            \\\"file_id\\\": file_id,\\n            \\\"get_preview_url\\\": true,\\n            \\\"share_id\\\": share_id,\\n            \\\"template_id\\\": \\\"\\\",\\n            \\\"get_subtitle_info\\\": true\\n        }\\n        //log(data);\\n        let json = JSON.parse(request('https://api.aliyundrive.com/v2/file/get_share_link_video_preview_play_info', {\\n            headers: headers,\\n            body: data,\\n            method: 'POST',\\n            timeout: 3000\\n        }));\\n        aliyunUrl = json.video_preview_play_info.live_transcoding_task_list;\\n        aliyunUrl.reverse();\\n\\n        return aliyunUrl;\\n    } catch (e) {\\n        log('根据共享链接获取播放地址失败>' + e.message);\\n        return \\\"\\\";\\n    }\\n}\\n\\nfunction getAliUrl(share_id, file_id, alitoken) {\\n    try {\\n        let urls = [];\\n        let names = [];\\n        let heads = [];\\n        let u = startProxyServer($.toString((aliSharePlayUrl, file_id, share_id, alitoken) => {\\n            function geturl(fileid, line) {\\n                //预加载时会变file_id,所以ts过期更新时还取原来的id\\n                let playUrlList = aliSharePlayUrl(share_id, fileid, alitoken) || [];\\n                let aliurl;\\n                playUrlList.forEach((item) => {\\n                    if (item.template_id == line) {\\n                        aliurl = item.url;\\n                        /*aliurl = JSON.parse(request(item.url, {\\n                            headers: {\\n                                'User-Agent': PC_UA,\\n                                'Referer': 'https://www.aliyundrive.com/'\\n                            },\\n                            onlyHeaders: true,\\n                            redirect: false,\\n                            timeout: 3000\\n                        })).headers.location[0];*/\\n                    }\\n                })\\n                //上面是获取阿里的播放地址\\n                //log(\\\"我在代理\\\" + aliurl);\\n                let home = aliurl.split('media.m3u8')[0];\\n                let f = fetch(aliurl, {\\n                    headers: {\\n                        'User-Agent': PC_UA,\\n                        'Referer': 'https://www.aliyundrive.com/'\\n                    },\\n                    timeout: 3000\\n                }).split(\\\"\\\\n\\\");\\n                let ff = f.map(it => {\\n                    if (it.startsWith(\\\"media-\\\")) {\\n                        return \\\"/proxy?url=\\\" + base64Encode(home + it);\\n                    }\\n                    return it;\\n                }).join(\\\"\\\\n\\\");\\n                //log('ufid-'+fileid);\\n                writeFile('hiker://files/cache/_fileSelect_' + fileid + '.m3u8', ff);\\n                return ff;\\n            }\\n            let url = base64Decode(MY_PARAMS.url);\\n            if (url.includes(\\\".ts\\\")) {\\n                let fid = url.split('&f=')[1].split('&')[0];\\n                //log('sfid-'+fid);\\n                let f = fetch('hiker://files/cache/_fileSelect_' + fid + '.m3u8').split(\\\"\\\\n\\\");\\n                f.forEach(it => {\\n                    if (it && it.startsWith('/proxy?url=')) {\\n                        let furl = base64Decode(it.replace('/proxy?url=', ''));\\n                        if (url.substr(url.indexOf('/media-'), url.indexOf('.ts')) == furl.substr(furl.indexOf('/media-'), furl.indexOf('.ts'))) {\\n                            url = furl;\\n                        }\\n                    }\\n                })\\n                let expires = url.split('x-oss-expires=')[1].split('&')[0];\\n                const lasttime = parseInt(expires) - Date.now() / 1000;\\n                if (lasttime < 60) {\\n                    //log('过期更新')\\n                    let line = url.split('/media')[0]; //取之前播放的ts段线路\\n                    line = line.substring(line.lastIndexOf('/') + 1);\\n                    let f = geturl(fid, line).split(\\\"\\\\n\\\");\\n                    f.forEach(it => {\\n                        if (it && it.startsWith('/proxy?url=')) {\\n                            let furl = base64Decode(it.replace('/proxy?url=', ''));\\n                            if (url.substr(url.indexOf('/media-'), url.indexOf('.ts')) == furl.substr(furl.indexOf('/media-'), furl.indexOf('.ts'))) {\\n                                url = furl;\\n                            }\\n                        }\\n                    })\\n\\n                } else {\\n                    //log('未过期')\\n                    //log(\\\"代理ts：\\\" + url);\\n                }\\n                return JSON.stringify({\\n                    statusCode: 302,\\n                    headers: {\\n                        \\\"Location\\\": url,\\n                        \\\"User-Agent\\\": PC_UA,\\n                        'Referer': 'https://www.aliyundrive.com/'\\n                    }\\n                });\\n            } else {\\n                //log('首次更新')\\n                let line = url.split('|')[1];\\n                let ff = geturl(file_id, line);\\n                return ff;\\n            }\\n        }, aliSharePlayUrl, file_id, share_id, alitoken));\\n\\n        let playUrlList = aliSharePlayUrl(share_id, file_id, alitoken) || [];\\n\\n        if (playUrlList.length > 0) {\\n            playUrlList.forEach((item) => {\\n                urls.push(u + \\\"?url=\\\" + base64Encode(item.url + \\\"|\\\" + item.template_id) + \\\"#.m3u8\\\");\\n                names.push(transcoding[item.template_id] ? transcoding[item.template_id] : item.template_height);\\n                heads.push({\\n                    'User-Agent': PC_UA,\\n                    'Referer': 'https://www.aliyundrive.com/'\\n                });\\n            })\\n            /*\\n            return {\\n                urls: urls,\\n                names: names,\\n                headers: heads\\n            };*/\\n            var mult = {\\n                urls: urls,\\n                names: names,\\n                headers: heads\\n            };\\n            if (zimu.length > 0) {\\n                for (let i in zimu) {\\n                    var zimut = zimu[i].tit;\\n                    if (fname.includes(zimut) || zimut.includes(fname.substring(0, fname.lastIndexOf('.')))) {\\n                        mult['subtitle'] = getsub(zimu[i].fid, zimu[i].ext);\\n                        break;\\n                    }\\n                }\\n            }\\n\\n            return mult;\\n        } else {\\n            log('未获取阿里播放地址，建议重进软件再试一次')\\n            return {};\\n        }\\n    } catch (e) {\\n        log('获取共享链接播放地址失败>' + e.message);\\n        return {};\\n    }\\n}\\n\\nif (cate == 'video') {\\n    if (getItem('quality', '') == '1') {\\n        //原画\\n        //accessTk();\\n        function oauthRedirect(code) {\\n            try {\\n                if (getMyVar('ored', '1') != '0') {\\n                    let json = fetch('https://api.xhofe.top/alist/ali_open/code', {\\n                        headers: {\\n                            'User-Agent': PC_UA,\\n                            'Referer': 'https://www.aliyundrive.com/'\\n\\n                        },\\n                        body: {\\n                            \\\"code\\\": code,\\n                            \\\"grant_type\\\": \\\"authorization_code\\\"\\n                        },\\n                        method: 'POST'\\n                    });\\n                    if (json == \\\"\\\"||!JSON.parse(json)) {\\n                        json = fetch('https://api-cf.nn.ci/alist/ali_open/code', {\\n                            headers: {\\n                                'User-Agent': PC_UA,\\n                                'Referer': 'https://www.aliyundrive.com/'\\n\\n                            },\\n                            body: {\\n                                \\\"code\\\": code,\\n                                \\\"grant_type\\\": \\\"authorization_code\\\"\\n                            },\\n                            method: 'POST'\\n                        });\\n                    }\\n                    log('获取RefreshTokenOpen');\\n                    if (json.includes('Too Many Requests')) {\\n                        putMyVar('ored', '0');\\n                        toast('请求太频繁，被封IP了');\\n                        log('请求太频繁，被封IP了');\\n                        return '';\\n                    } else {\\n                        putMyVar('ored', '1');\\n                        if (JSON.parse(json).refresh_token) {\\n                            let getRefreshTokenOpen = JSON.parse(json).refresh_token;\\n                            OpenToken.RefreshTokenOpen = getRefreshTokenOpen;\\n                            let getAccessTokenOpen = JSON.parse(json).token_type + ' ' + JSON.parse(json).access_token;\\n                            OpenToken.AccessTokenOpen = getAccessTokenOpen;\\n                            writeFile(\\\"hiker://files/rules/icy/icy-ali-OpenToken.json\\\", JSON.stringify(OpenToken));\\n\\n                            putMyVar('redirect', '1');\\n                        }\\n                    }\\n                }\\n            } catch (e) {}\\n        };\\n\\n        function oauthRequest() {\\n            try {\\n                let json = fetch('https://open.aliyundrive.com/oauth/users/authorize?client_id=' + '76917ccccd4441c39457a04f6084fb2f' + '&redirect_uri=https://alist.nn.ci/tool/aliyundrive/callback&scope=user:base,file:all:read,file:all:write&state=', {\\n                    headers: {\\n                        'User-Agent': PC_UA,\\n                        'Referer': 'https://www.aliyundrive.com/',\\n                        'authorization': reaccessTk, //getAccessToken\\n                        'x-canary': 'client=web,app=share,version=v2.3.1',\\n                        'x-share-token': sharetoken\\n\\n                    },\\n                    body: {\\n                        \\\"authorize\\\": 1,\\n                        \\\"scope\\\": \\\"user:base,file:all:read,file:all:write\\\"\\n                    },\\n                    method: 'POST'\\n                });\\n                //log('oauthreq\\\\n' + json);\\n                let code = JSON.parse(json).redirectUri.split(\\\"code=\\\")[1];\\n                //log(code);\\n                oauthRedirect(code);\\n            } catch (e) {\\n                reaccessTk = '';\\n                accessTk();\\n            }\\n        };\\n\\n        function refreshOpenToken() {\\n            try {\\n                if (getMyVar('rot', '1') != '0') {\\n                    let json = fetch('https://api.xhofe.top/alist/ali_open/token', {\\n                        headers: {\\n                            'User-Agent': PC_UA,\\n                            'Referer': 'https://www.aliyundrive.com/'\\n                        },\\n                        body: {\\n                            'grant_type': 'refresh_token',\\n                            'refresh_token': OpenToken.RefreshTokenOpen\\n                        },\\n                        method: 'POST'\\n                    });\\n                    if (json == \\\"\\\") {\\n                        json = fetch('https://api-cf.nn.ci/alist/ali_open/code', {\\n                            headers: {\\n                                'User-Agent': PC_UA,\\n                                'Referer': 'https://www.aliyundrive.com/'\\n                            },\\n                            body: {\\n                                'grant_type': 'refresh_token',\\n                                'refresh_token': OpenToken.RefreshTokenOpen\\n                            },\\n                            method: 'POST'\\n                        });\\n                    }\\n                    log('获取AccessTokenOpen');\\n                    if (json.includes('Too Many Requests')) {\\n                        putMyVar('rot', '0');\\n                        toast('请求太频繁，被封IP了');\\n                        //log('请求太频繁，被封IP了');\\n                        return '';\\n                    } else {\\n                        putMyVar('rot', '1');\\n                        if (JSON.parse(json).refresh_token) {\\n                            let getRefreshTokenOpen = JSON.parse(json).refresh_token;\\n                            OpenToken.RefreshTokenOpen = getRefreshTokenOpen;\\n                            let getAccessTokenOpen = JSON.parse(json).token_type + ' ' + JSON.parse(json).access_token;\\n                            OpenToken.AccessTokenOpen = getAccessTokenOpen;\\n                            writeFile(\\\"hiker://files/rules/icy/icy-ali-OpenToken.json\\\", JSON.stringify(OpenToken));\\n                        }\\n                    }\\n\\n                }\\n            } catch (e) {}\\n        };\\n\\n        function copy(fileId) {\\n            try {\\n                let json = fetch('https://api.aliyundrive.com/adrive/v2/batch', {\\n                    headers: {\\n                        'User-Agent': PC_UA,\\n                        'Referer': 'https://www.aliyundrive.com/',\\n                        'authorization': reaccessTk,\\n                        //getAccessToken\\n                        'x-canary': 'client=web,app=share,version=v2.3.1',\\n                        'x-share-token': sharetoken\\n\\n                    },\\n                    body: {\\n                        \\\"requests\\\": [{\\n                            \\\"body\\\": {\\n                                \\\"file_id\\\": fileId,\\n                                \\\"share_id\\\": shareId,\\n                                \\\"auto_rename\\\": true,\\n                                \\\"to_parent_file_id\\\": \\\"root\\\",\\n                                \\\"to_drive_id\\\": defdriveid\\n                            },\\n                            \\\"headers\\\": {\\n                                \\\"Content-Type\\\": \\\"application/json\\\"\\n                            },\\n                            \\\"id\\\": \\\"0\\\",\\n                            \\\"method\\\": \\\"POST\\\",\\n                            \\\"url\\\": \\\"/file/copy\\\"\\n                        }],\\n                        \\\"resource\\\": \\\"file\\\"\\n                    },\\n                    method: 'POST'\\n                });\\n                //log('copy\\\\n' + json);\\n                return JSON.parse(json).responses[0].body.file_id;\\n            } catch (e) {\\n                return \\\"\\\";\\n            }\\n        };\\n\\n        function open(fileId) {\\n            try {\\n                let json = \\\"\\\";\\n                let number = 0;\\n                do {\\n                    json = fetch('https://open.aliyundrive.com/adrive/v1.0/openFile/getDownloadUrl', {\\n                        headers: {\\n                            'User-Agent': PC_UA,\\n                            'Referer': 'https://www.aliyundrive.com/',\\n                            'authorization': OpenToken.AccessTokenOpen\\n                            //getAccessTokenOpen\\n\\n                        },\\n                        body: {\\n                            'file_id': fileId,\\n                            'drive_id': defdriveid\\n                        },\\n                        method: 'POST'\\n                    });\\n                    //log('open\\\\n' + json);\\n                    if (json.includes('\\\"url\\\":\\\"http')) {\\n                        break;\\n                    }\\n                    if (json.includes(\\\"TooManyRequests\\\")) {\\n                        //deletee(fileId);\\n                        toast('Too Many Requests');\\n                        //log('TooManyRequests');\\n                        //return 'toast://请求太频繁';\\n                    }\\n                    if (getMyVar('redirect', '0') == '0') {\\n                        oauthRequest();\\n                    } else {\\n                        refreshOpenToken();\\n                    }\\n                    //refreshOpenToken();\\n                    number++\\n                } while (number < 2);\\n                //deletee(fileId);\\n                return JSON.parse(json).url + ';{Referer@https://www.aliyundrive.com/}';\\n            } catch (e) {\\n                return 'hiker://empty';\\n            }\\n        };\\n\\n        function deletee(fileId) {\\n\\n            fetch('https://api.aliyundrive.com/adrive/v2/batch', {\\n                headers: {\\n                    'User-Agent': PC_UA,\\n                    'Referer': 'https://www.aliyundrive.com/',\\n                    'authorization': reaccessTk,\\n                    'x-canary': 'client=web,app=share,version=v2.3.1',\\n                    'x-share-token': sharetoken\\n\\n                },\\n                body: {\\n                    \\\"requests\\\": [{\\n                        \\\"body\\\": {\\n                            \\\"drive_id\\\": defdriveid,\\n                            \\\"file_id\\\": fileId\\n                        },\\n                        \\\"headers\\\": {\\n                            \\\"Content-Type\\\": \\\"application/json\\\"\\n                        },\\n                        \\\"id\\\": fileId,\\n                        \\\"method\\\": \\\"POST\\\",\\n                        \\\"url\\\": \\\"/file/delete\\\"\\n                    }],\\n                    \\\"resource\\\": \\\"file\\\"\\n                },\\n                method: 'POST'\\n            });\\n\\n            /*\\n            fetch('https://open.aliyundrive.com/adrive/v1.0/openFile/delete', {\\n                headers: {\\n                    'User-Agent': PC_UA,\\n                    'Referer': 'https://www.aliyundrive.com/',\\n                    'authorization': getItem('getAccessTokenOpen', ''),\\n                    'x-share-token': sharetoken\\n\\n\\n                },\\n                body: {\\n                    \\\"drive_id\\\": defdriveid,\\n                    \\\"file_id\\\": fileId\\n                },\\n                method: 'POST'\\n            });\\n            */\\n            //log('dele\\\\n' + json);\\n        };\\n\\n\\n        //处理视频  \\n        var dsid = shareId;\\n        var dfid = input;\\n        if (resdriveid != null && resdriveid != \\\"\\\") {\\n            defdriveid = resdriveid;\\n        }\\n        let fileId = copy(dfid);\\n        var play = open(fileId);\\n        if (fileId.length > 0) {\\n            deletee(fileId);\\n        }\\n        if (zimu.length > 0) {\\n            for (let i in zimu) {\\n                var zimut = zimu[i].tit;\\n                if (fname.includes(zimut) || zimut.includes(fname.substring(0, fname.lastIndexOf('.')))) {\\n                    play = JSON.stringify({\\n                        urls: [play.split(';{')[0]],\\n                        headers: [{\\n                            'Referer': 'https://www.aliyundrive.com/'\\n                        }],\\n                        subtitle: getsub(zimu[i].fid, zimu[i].ext)\\n                    })\\n                    break;\\n                }\\n            }\\n        }\\n    } else {\\n        //普画  \\n        var dsid = shareId;\\n        var dfid = input;\\n\\n        var play = JSON.stringify(getAliUrl(\\n            shareId,\\n            input,\\n            reftoken\\n        ));\\n\\n    }\\n}\\n/*} else if (cate == 'image') {\\n    //处理文档\\n    accessTk();\\n\\n    var json = fetch('https://api.aliyundrive.com/v2/file/get_share_link_download_url', {\\n        headers: {\\n            'Content-Type': 'application/json',\\n            'Authorization': accessTk(),\\n            'X-Share-Token': sharetoken\\n        },\\n        body: '{\\\"share_id\\\":\\\"' + shareId + '\\\",\\\"expire_sec\\\": 600,\\\"file_id\\\":\\\"' + input + '\\\"}',\\n        method: 'POST'\\n    });\\n\\n    //log(json);\\n\\n    var loclink = JSON.parse(fetch(JSON.parse(json).url, {\\n        headers: {\\n            'User-Agent': MOBILE_UA,\\n            'Content-Type': 'application/x-www-form-urlencoded',\\n            'Referer': 'https://www.aliyundrive.com/'\\n        },\\n        redirect: false,\\n        withStatusCode: true\\n    })).headers.location[0];\\n\\n    //log(loclink);\\n    if (cate == 'image') {\\n        var play = 'pics://' + loclink + '@Referer=https://www.aliyundrive.com/';\\n    } else {\\n        var play = loclink + ';{Referer@https://www.aliyundrive.com/}';\\n    }*/\\nelse if (cate == 'audio') {\\n    var json = fetch('https://api.aliyundrive.com/v2/file/get_share_link_download_url', {\\n        headers: {\\n            'Content-Type': 'application/json',\\n            'Authorization': reaccessTk,\\n            'X-Share-Token': sharetoken\\n        },\\n        body: '{\\\"share_id\\\":\\\"' + shareId + '\\\",\\\"get_audio_play_info\\\": true,\\\"file_id\\\":\\\"' + input + '\\\"}',\\n        method: 'POST'\\n    });\\n    //log(json);\\n    var play = JSON.parse(json).download_url + '#isMusic=true#;{Referer@https://www.aliyundrive.com/}';\\n} else if (ftype.endsWith('.srt') || ftype.endsWith('.vtt') || ftype.endsWith('.ass')) {\\n    var json = fetch('https://api.aliyundrive.com/v2/file/get_share_link_download_url', {\\n        headers: {\\n            'Content-Type': 'application/json',\\n            'Authorization': reaccessTk,\\n            'X-Share-Token': sharetoken\\n        },\\n        body: '{\\\"share_id\\\":\\\"' + shareId + '\\\",\\\"file_id\\\":\\\"' + input + '\\\"}',\\n        method: 'POST'\\n    });\\n    //log(json);\\n    var zimul = JSON.parse(json).download_url;\\n    downloadFile(zimul, 'hiker://files/download/XYQ_subtitling' + fname.substring(fname.lastIndexOf(\\\".\\\")), {\\n        'Referer': 'https://www.aliyundrive.com/'\\n    });\\n    var play = 'toast://字幕文件已下载到hiker://files/download/XYQ_subtitling' + fname.substring(fname.lastIndexOf(\\\".\\\"))\\n    // + ';{Referer@https://www.aliyundrive.com/}';\\n} else {\\n    var play = 'toast://该格式暂未支持，目前只支持视频。'\\n}\"},{\"col_type\":\"movie_3\",\"name\":\"推送代码\",\"path\":\"pushcode\",\"rule\":\"js:\\nlet push = JSON.stringify({\\n    \\\"name\\\": pushname,\\n    \\\"url\\\": tuisong.join('#'),\\n    \\\"share_id\\\": shareId,\\n    \\\"refresh_token\\\": reftoken\\n}).replace(/\\\\&/g, '＆＆');\\nif (tuisong.length > 0) {\\n    items.unshift({\\n        title: \\\"📽推送当前页音视频📺\\\",\\n        url: $(push).lazyRule(() => {\\n            return 'hiker://page/push?rule=XYQ推送&pushurl=' + encodeURIComponent(input);\\n        }),\\n        col_type: \\\"scroll_button\\\"\\n    });\\n    items.unshift({\\n        title: (getItem('quality', '') == '1' ? '原画播√' : '转码播√'),\\n        url: `hiker://empty@lazyRule=.js:getItem('quality','0')=='1'?setItem('quality','0'):setItem('quality','1');refreshPage();'toast://切换成功！'`,\\n        col_type: 'scroll_button'\\n    });\\n    items.unshift({\\n    title: (getItem('singlepush', '') == '1' ? '单推√' : '单推╳'),\\n    url: `hiker://empty@lazyRule=.js:getItem('singlepush','0')=='1'?setItem('singlepush','0'):setItem('singlepush','1');refreshPage();'toast://切换成功！'`,\\n    col_type: 'scroll_button'\\n});\\n}\\n\"},{\"col_type\":\"movie_3\",\"name\":\"登入\",\"path\":\"Login\",\"rule\":\"d.push({\\n    title: \\\"⛅️点击我登录\\\",\\n    url: $(\\\"hiker://empty###noRecordHistory##noHistory#\\\").rule(() => {\\n        let d = [];\\n        let ntoken = [];\\n        if (fileExist(\\\"hiker://files/rules/icy/icy-ali-token.json\\\")) {\\n            ntoken = JSON.parse(fetch('hiker://files/rules/icy/icy-ali-token.json', {}));\\n        }\\n        let url = 'https://www.aliyundrive.com/sign'\\n        let js = $.toString((ntoken) => {\\n            const tokenFunction = function() {\\n                var token = JSON.parse(localStorage.getItem('token'))\\n                if (token && token.user_id) {\\n                    let alistfile = \\\"hiker://files/rules/icy/icy-ali-token.json\\\";\\n                    ntoken[0] = token;\\n                    fy_bridge_app.writeFile(alistfile, JSON.stringify(ntoken));\\n                    localStorage.clear();\\n                    alert('TOKEN获取成功，返回后刷新页面！');\\n                    fy_bridge_app.parseLazyRule(`hiker://empty@lazyRule=.js:refreshX5WebView('');`);\\n                    fy_bridge_app.back();\\n                    return;\\n                } else {\\n                    token_timer();\\n                }\\n            }\\n            var token_timer = function() {\\n                setTimeout(tokenFunction, 500)\\n            };\\n            tokenFunction();\\n        }, ntoken)\\n        d.push({\\n            url: url,\\n            col_type: 'x5_webview_single',\\n            desc: '100%&&float',\\n            extra: {\\n                canBack: true,\\n                ua: PC_UA,\\n                js: js\\n            }\\n        })\\n        setResult(d);\\n    }),\\n    col_type: 'text_center_1'\\n});\"}]","proxy":"","icon":"https://www.alipansou.com/favicon.ico"}