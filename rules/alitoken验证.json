{"last_chapter_rule":"","pageList":[{"col_type":"movie_3","name":"推送","path":"push","rule":"js:\nlet items = [];\nlet pushin = decodeURIComponent(getParam(\"pushurl\"));\n\nlet tvip = getItem('hikertvboxset', '');\n\nitems.push({\n    title: '当前TV端IP：' + tvip,\n    url: \"input://\" + getItem('hikertvboxset', 'http://' + getIP() + ':9978') + \"////请输入TVBox端的IP地址，如http://\" + getIP() + \":9978.js:setItem('hikertvboxset',input);refreshPage()\",\n    col_type: 'flex_button'\n});\nvar bod = '';\nif (pushin.startsWith('alitoken@')) {\n    bod = 'do=push&url=' + pushin;\n} else if (pushin.startsWith('token@')) {\n    bod = 'do=pushAliToken&push_AliToken=' + pushin;\n}\n\nvar state = request(tvip + '/action', {\n    headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n        'Referer': tvip\n    },\n    timeout: 2000,\n    body: bod,\n    method: 'POST'\n});\n//log(state);\nif (state == 'ok') {\n    //log(state);\n    items.push({\n        title: \"√\" + state,\n        url: \"hiker://empty\",\n        col_type: \"text_center_1\"\n    });\n} else {\n    //log(state);\n    items.push({\n        title: \"╳\" + state,\n        url: \"hiker://empty\",\n        col_type: \"text_center_1\"\n    });\n\n}\n\nsetResult(items);"}],"title":"alitoken验证","author":"香雅情","version":1,"type":"video","url":"hiker://empty","col_type":"movie_3","class_name":"","class_url":"","area_name":"","area_url":"","sort_name":"","year_name":"","sort_url":"","year_url":"","find_rule":"js:\nvar d = [];\nd.push({\n    title: \"⛅️登录获取自己的token\",\n    url: $(\"hiker://empty###noRecordHistory##noHistory#\").rule(() => {\n        let d = [];\n        let url = 'https://www.aliyundrive.com/sign'\n        let js = $.toString(() => {\n            const tokenFunction = function() {\n                var stor = \"\";\n                if (localStorage.getItem('token') != null) {\n                    stor = localStorage.getItem(\"token\");\n                } else {\n                    stor = sessionStorage.getItem(\"token\");\n                }\n                var token = JSON.parse(stor);\n                if (token && token.user_id) {\n                    let alistfile = \"hiker://files/rules/xyq/myalitoken.txt\";\n                    let tokendata = token.refresh_token;\n                    //fba.log(tokendata);\n                    fy_bridge_app.writeFile(alistfile, tokendata);\n                    localStorage.clear();\n                    alert('TOKEN获取成功，返回后刷新页面！');\n                    fy_bridge_app.parseLazyRule(`hiker://empty@lazyRule=.js:refreshX5WebView('');`);\n                    fy_bridge_app.back();\n                    return;\n                } else {\n                    token_timer();\n                }\n            }\n            var token_timer = function() {\n                setTimeout(tokenFunction, 500)\n            };\n            tokenFunction();\n        })\n        d.push({\n            url: url,\n            col_type: 'x5_webview_single',\n            desc: '100%&&float',\n            extra: {\n                canBack: true,\n                ua: PC_UA,\n                js: js\n            }\n        })\n        setResult(d);\n    }),\n    col_type: 'text_center_1'\n});\nif (fileExist(\"hiker://files/rules/xyq/myalitoken.txt\")) {\n    let mydeftok = fetch(\"hiker://files/rules/xyq/myalitoken.txt\", {});\n    d.push({\n        title: mydeftok,\n        url: $(mydeftok).lazyRule(() => {\n            return 'copy://' + input\n        }),\n        col_type: \"text_1\",\n        desc: \"\",\n        pic_url: \"\"\n    }, {\n        title: 'Token属于私密信息，请不要截图本页不打码或直接把Token分享给他人。',\n        url: 'hiker://empty',\n        col_type: \"text_1\",\n        desc: \"\",\n        pic_url: \"\"\n    });\n}\nvar deftok = '';\nif (fileExist(\"hiker://files/rules/xyq/alitoken.txt\") && getMyVar('alitoken', '') == '') {\n    deftok = fetch(\"hiker://files/rules/xyq/alitoken.txt\", {});\n    putMyVar('alitoken', deftok);\n}\nlog(deftok);\nd.push({\n    title: getMyVar('alitoken', deftok),\n    url: \"input://\" + \"////请输入阿里token数据。.js:putMyVar('alitoken',input);refreshPage()\",\n    col_type: \"icon_1_search\",\n    extra: {\n        titleVisible: false\n    }\n});\n\nd.push({\n    title: '验证',\n    url: $('hiker://empty').lazyRule(() => {\n        clearMyVar('resulttok');\n        var reftoken = getMyVar('alitoken', '');\n        if (reftoken.startsWith('http')) {\n            reftoken = fetch(reftoken, {\n                headers: {\n                    'User-Agent': 'okhttp/3.12.11'\n                }\n            });\n        }\n        if (reftoken == '') {\n            return 'toast://token为空！';\n        } else if (reftoken.length != 32) {\n            return 'toast://token不正确！';\n        } else {\n            var refresh = fetch('https://auth.aliyundrive.com/v2/account/token', {\n                headers: {\n                    'Content-Type': 'application/json',\n                    'User-Agent': PC_UA,\n                    'Referer': 'https://www.aliyundrive.com/'\n                },\n                body: '{\"refresh_token\":\"' + reftoken + '\",\"grant_type\":\"refresh_token\"}',\n                method: 'POST'\n            });\n            putMyVar('resulttok', refresh);\n            putMyVar('alitoken', JSON.parse(refresh).refresh_token);\n            refreshPage();\n            \n            \n            return 'hiker://empty'\n        }\n\n    }),\n    col_type: \"text_2\",\n    desc: \"\",\n    pic_url: \"\"\n});\n\nif (getMyVar('resulttok', '').includes('\"refresh_token\"')) {\n    var tokenjson = JSON.parse(getMyVar('resulttok', '{}'));\n    let tokendata = tokenjson.refresh_token;\n\n\n    d.push({\n        title: '复制完整结果',\n        url: $('hiker://empty').lazyRule(() => {\n            return 'copy://' + getMyVar('resulttok', '')\n        }),\n        col_type: \"text_2\",\n        desc: \"\",\n        pic_url: \"\"\n    }, {\n        title: '推香雅情线路Token',\n        url: $('hiker://empty').lazyRule((tokendata) => {\n            //return 'copy://' + getMyVar('resulttok', '')\n            return 'hiker://page/push?pushurl=' + encodeURIComponent('alitoken@' + tokendata);\n        }, tokendata),\n        col_type: \"text_2\",\n        desc: \"\",\n        pic_url: \"\"\n    }, {\n        title: '推影视仓设置Token',\n        url: $('hiker://empty').lazyRule((tokendata) => {\n            //return 'copy://' + getMyVar('resulttok', '')\n            return 'hiker://page/push?pushurl=' + encodeURIComponent('token@' + tokendata);\n        }, tokendata),\n        col_type: \"text_2\",\n        desc: \"\",\n        pic_url: \"\"\n    });\n\n\n    d.push({\n        title: '当前用户：' + tokenjson.nick_name + ' ' + tokenjson.user_name,\n        url: 'hiker://empty',\n        col_type: \"avatar\",\n        pic_url: tokenjson.avatar\n    });\n\n    d.push({\n        title: tokendata,\n        url: $(tokendata).lazyRule(() => {\n            return 'copy://' + input\n        }),\n        col_type: \"text_1\",\n        desc: \"\",\n        pic_url: \"\"\n    });\n\n    if (!fileExist(\"hiker://files/rules/xyq/alitoken.txt\")) {\n        writeFile(\"hiker://files/rules/xyq/alitoken.txt\", tokendata);\n    } else {\n        writeFile(\"hiker://files/rules/xyq/alitoken.txt\", tokendata);\n    }\n}\nd.push({\n    title: getMyVar('resulttok', ''),\n    url: '',\n    col_type: \"long_text\",\n    desc: \"\",\n    pic_url: \"\"\n});\n\nsetHomeResult(d);","searchFind":"","search_url":"","group":"②推送","detail_col_type":"movie_1","detail_find_rule":"","sdetail_col_type":"movie_1","sdetail_find_rule":"","ua":"mobile","preRule":"","pages":"[{\"col_type\":\"movie_3\",\"name\":\"推送\",\"path\":\"push\",\"rule\":\"js:\\nlet items = [];\\nlet pushin = decodeURIComponent(getParam(\\\"pushurl\\\"));\\n\\nlet tvip = getItem('hikertvboxset', '');\\n\\nitems.push({\\n    title: '当前TV端IP：' + tvip,\\n    url: \\\"input://\\\" + getItem('hikertvboxset', 'http://' + getIP() + ':9978') + \\\"////请输入TVBox端的IP地址，如http://\\\" + getIP() + \\\":9978.js:setItem('hikertvboxset',input);refreshPage()\\\",\\n    col_type: 'flex_button'\\n});\\nvar bod = '';\\nif (pushin.startsWith('alitoken@')) {\\n    bod = 'do=push&url=' + pushin;\\n} else if (pushin.startsWith('token@')) {\\n    bod = 'do=pushAliToken&push_AliToken=' + pushin;\\n}\\n\\nvar state = request(tvip + '/action', {\\n    headers: {\\n        'Content-Type': 'application/x-www-form-urlencoded',\\n        'Referer': tvip\\n    },\\n    timeout: 2000,\\n    body: bod,\\n    method: 'POST'\\n});\\n//log(state);\\nif (state == 'ok') {\\n    //log(state);\\n    items.push({\\n        title: \\\"√\\\" + state,\\n        url: \\\"hiker://empty\\\",\\n        col_type: \\\"text_center_1\\\"\\n    });\\n} else {\\n    //log(state);\\n    items.push({\\n        title: \\\"╳\\\" + state,\\n        url: \\\"hiker://empty\\\",\\n        col_type: \\\"text_center_1\\\"\\n    });\\n\\n}\\n\\nsetResult(items);\"}]","proxy":"","icon":""}